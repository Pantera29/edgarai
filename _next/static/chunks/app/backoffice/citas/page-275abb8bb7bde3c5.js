(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9616],{40659:function(e,a,s){Promise.resolve().then(s.bind(s,95683))},95683:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return K}});var t=s(57437),i=s(2265),r=s(62869),n=s(95186),l=s(73578),d=s(26110),o=s(26815),c=s(2141),u=s(77992),m=s(849),h=s(53647),x=s(45727),p=s(70236),f=s(53178),v=s(71344),g=s(35613),j=s(24298),_=s(89048);s(87676);var y=s(84190),b=s(31047),N=s(91723),w=s(22252),C=s(66901),S=s(45131),k=s(95452),Z=s(27648),E=s(1098),z=s(71878),D=s(6639),M=s(94508),R=s(81103),P=s(43643);i.forwardRef((e,a)=>{let{className:s,children:i,...r}=e;return(0,t.jsxs)(P.fC,{ref:a,className:(0,M.cn)("relative overflow-hidden",s),...r,children:[(0,t.jsx)(P.l_,{className:"h-full w-full rounded-[inherit]",children:i}),(0,t.jsx)(F,{}),(0,t.jsx)(P.Ns,{})]})}).displayName=P.fC.displayName;let F=i.forwardRef((e,a)=>{let{className:s,orientation:i="vertical",...r}=e;return(0,t.jsx)(P.gb,{ref:a,orientation:i,className:(0,M.cn)("flex touch-none select-none transition-colors","vertical"===i&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===i&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...r,children:(0,t.jsx)(P.q4,{className:"relative flex-1 rounded-full bg-border"})})});F.displayName=P.gb.displayName;let H=e=>{let{date:a,dayInfo:s,onClick:i,disabled:r,isSelected:n}=e,l="w-8 h-8 p-0 font-normal relative text-sm flex items-center justify-center rounded-md";return r?(0,t.jsx)("button",{disabled:!0,className:(0,M.cn)(l,"text-muted-foreground opacity-50"),children:(0,t.jsx)("time",{dateTime:(0,p.Z)(a,"yyyy-MM-dd"),children:(0,p.Z)(a,"d")})}):(0,t.jsx)("button",{onClick:i,className:(0,M.cn)(l,"transition-colors",n&&"ring-2 ring-primary ring-offset-2 bg-primary text-primary-foreground",!n&&"hover:bg-accent hover:text-accent-foreground",s.isFullyBlocked?"bg-[#F3F4F6] text-gray-500":"high"===s.status?"bg-[#E6F4EA] text-green-700":"medium"===s.status?"bg-[#FEF3C7] text-yellow-700":"bg-[#FEE2E2] text-red-700"),children:(0,t.jsx)("time",{dateTime:(0,p.Z)(a,"yyyy-MM-dd"),children:(0,p.Z)(a,"d")})})},A=()=>(0,t.jsxs)("div",{className:"flex justify-center gap-6 text-xs mt-4 px-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 rounded bg-[#E6F4EA]"}),(0,t.jsx)("span",{children:"Disponible"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 rounded bg-yellow-50"}),(0,t.jsx)("span",{children:"Moderado"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 rounded bg-[#FEE2E2]"}),(0,t.jsx)("span",{children:"Limitado"})]})]});function O(e){let{selectedDate:a,onSelect:s,blockedDates:n,operatingHours:l,turnDuration:d,appointments:o,onTimeSlotSelect:c,selectedService:u,className:m}=e,[h,x]=(0,i.useState)([]),[v,g]=(0,i.useState)(!1),[y,N]=(0,i.useState)(new Date),[w,C]=(0,i.useState)(null),S=(0,i.useRef)(null),k=e=>{let a=0===e.getDay()?1:e.getDay()+1,s=l.find(e=>e.dia_semana===a),t=(0,p.Z)(e,"yyyy-MM-dd"),i=n.find(e=>e.fecha===t);if(!s||!s.es_dia_laboral)return{percentage:0,status:"blocked",totalSlots:0,availableSlots:0,isFullyBlocked:!0,isPartiallyBlocked:!1,blockReason:"D\xeda no laborable"};if(null==i?void 0:i.dia_completo)return{percentage:0,status:"blocked",totalSlots:0,availableSlots:0,isFullyBlocked:!0,isPartiallyBlocked:!1,blockReason:i.motivo};let r=!!i&&!i.dia_completo,c=(0,f.Z)(s.hora_apertura,"HH:mm:ss",e),u=Math.floor(((0,f.Z)(s.hora_cierre,"HH:mm:ss",e).getTime()-c.getTime())/6e4/d)*s.servicios_simultaneos_max,m=o.filter(e=>(0,p.Z)(new Date(e.fecha_hora),"yyyy-MM-dd")===t).reduce((e,a)=>e+Math.ceil(a.servicios.duracion_estimada/d),0),h=(u-m)/u*100,x=100-h;return{percentage:h,status:x>80?"low":x>50?"medium":"high",totalSlots:u,availableSlots:u-m,nextAvailable:void 0,peakHours:void 0,isFullyBlocked:!1,isPartiallyBlocked:r,blockReason:null==i?void 0:i.motivo}},Z=e=>{let a=0===e.getDay()?1:e.getDay()+1,s=l.find(e=>e.dia_semana===a);if(!s||!s.es_dia_laboral)return[];let t=[],i=(0,f.Z)(s.hora_apertura,"HH:mm:ss",e),r=(0,f.Z)(s.hora_cierre,"HH:mm:ss",e),n=(0,p.Z)(e,"yyyy-MM-dd"),c=o.filter(e=>(0,p.Z)(new Date(e.fecha_hora),"yyyy-MM-dd")===n),u=i;for(;u<r;){let a=(0,p.Z)(u,"HH:mm"),i=P(e,a),r=c.filter(e=>{let s=(0,p.Z)(new Date(e.fecha_hora),"HH:mm"),t=(0,p.Z)((0,j.Z)(new Date(e.fecha_hora),e.servicios.duracion_estimada),"HH:mm");return a>=s&&a<t}),n=r.length,l=i?0:Math.max(0,s.servicios_simultaneos_max-n);t.push({time:a,available:l,isBlocked:i,blockReason:i?F(e,a):void 0,existingAppointments:r.map(e=>({id:e.id_uuid,clientName:e.clientes.nombre,serviceName:e.servicios.nombre,duration:e.servicios.duracion_estimada}))}),u=(0,j.Z)(u,d)}return t},P=(e,a)=>{let s=(0,p.Z)(e,"yyyy-MM-dd"),t=n.find(e=>e.fecha===s);return!!t&&(!!t.dia_completo||!!t.hora_inicio&&!!t.hora_fin&&a>=t.hora_inicio&&a<=t.hora_fin)},F=(e,a)=>{let s=(0,p.Z)(e,"yyyy-MM-dd"),t=n.find(e=>e.fecha===s);return(null==t?void 0:t.motivo)||"Horario no disponible"};return(0,i.useEffect)(()=>{a&&x(Z(a))},[a,l,n,d]),(0,t.jsx)("div",{className:"h-full p-1",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-[0.6fr,1.4fr] gap-8",children:[(0,t.jsx)("div",{className:"w-full flex justify-center",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl border shadow-sm space-y-4 w-full max-w-[350px]",children:[(0,t.jsx)("div",{className:"p-4 border-b",children:(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Calendario de disponibilidad"})}),(0,t.jsx)("div",{className:"flex justify-center px-2 py-4",children:(0,t.jsx)("div",{className:"w-fit",children:(0,t.jsx)(E.f,{mode:"single",selected:a||void 0,onSelect:e=>{e&&!(0,z.Z)(e,(0,D.Z)(new Date))&&s(e)},month:y,onMonthChange:N,locale:_.Z,components:{Day:e=>{let{date:i}=e;return(0,t.jsx)(H,{date:i,dayInfo:k(i),onClick:()=>{(0,z.Z)(i,(0,D.Z)(new Date))||s(i)},disabled:(0,z.Z)(i,(0,D.Z)(new Date)),isSelected:!!a&&(0,p.Z)(i,"yyyy-MM-dd")===(0,p.Z)(a,"yyyy-MM-dd")})}},className:"[&_.rdp-months]:flex [&_.rdp-months]:justify-center [&_.rdp-day]:h-8 [&_.rdp-day]:w-8 [&_.rdp-day_button]:h-8 [&_.rdp-day_button]:w-8 [&_.rdp-head_cell]:text-sm [&_.rdp-cell]:p-0"})})}),(0,t.jsx)("div",{className:"pb-4",children:(0,t.jsx)(A,{})})]})}),(0,t.jsx)("div",{className:"lg:pl-0",children:a?(0,t.jsxs)("div",{ref:S,className:"space-y-6",children:[(0,t.jsx)("div",{className:"bg-white rounded-xl border shadow-sm p-4",children:(0,t.jsxs)("h3",{className:"text-lg font-medium",children:["Horarios disponibles para ",(0,p.Z)(a,"EEEE d 'de' MMMM",{locale:_.Z})]})}),(0,t.jsx)("div",{className:"bg-white rounded-xl border shadow-sm",children:a&&h.length?(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:h.map((e,s)=>{var i;let n=e.isBlocked,l=e.time===w,d=e.existingAppointments&&e.existingAppointments.length>0;return(0,t.jsxs)(r.z,{variant:"outline",className:(0,M.cn)("h-auto py-4 relative group transition-all",n?"bg-red-50 text-red-700 border-red-200 hover:bg-red-50":0===e.available?"bg-yellow-50 text-yellow-700 border-yellow-200 hover:bg-yellow-50":l?"bg-primary/20 border-primary ring-2 ring-primary ring-offset-1":"bg-green-50 text-green-700 border-green-200 hover:bg-green-100 hover:border-green-400"),disabled:n||!u||0===e.available,onClick:()=>{(0,z.Z)(a,(0,D.Z)(new Date))||(c&&c(e),C(e.time))},children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsx)("span",{className:"text-base font-semibold",children:e.time}),(0,t.jsxs)("span",{className:"text-xs font-medium",children:[e.available," ",1===e.available?"espacio":"espacios"]})]}),(0,t.jsx)(R.TooltipProvider,{children:(0,t.jsxs)(R.u,{children:[(0,t.jsx)(R.aJ,{asChild:!0,children:(0,t.jsx)("div",{className:"absolute inset-0"})}),(0,t.jsx)(R._v,{side:"top",className:"w-64",children:(0,t.jsx)("div",{className:"space-y-2",children:n?(0,t.jsx)("p",{className:"text-red-600",children:e.blockReason}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{className:"font-medium",children:[e.available," ",1===e.available?"espacio disponible":"espacios disponibles"]}),d&&(0,t.jsxs)("div",{className:"text-sm space-y-1",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Citas agendadas:"}),null===(i=e.existingAppointments)||void 0===i?void 0:i.map((e,a)=>(0,t.jsx)("div",{className:"flex items-center gap-1",children:(0,t.jsx)("span",{children:e.serviceName})},a))]})]})})})]})})]},s)})})}):null})]}):(0,t.jsx)("div",{className:"h-full flex items-center justify-center p-8 bg-white rounded-xl border shadow-sm text-muted-foreground",children:(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)(b.Z,{className:"w-12 h-12 mx-auto text-muted-foreground/50"}),(0,t.jsx)("p",{children:"Seleccione una fecha para ver los horarios disponibles"})]})})})]})})}var T=s(66070),B=s(47625),V=s(21156),q=s(54061);function I(e){let{title:a,value:s,icon:i,description:r,trend:n=[],color:l="slate",onClick:d,className:o}=e,c=n.map(e=>({value:e}));return(0,t.jsxs)(T.Zb,{className:(0,M.cn)("transition-all duration-200 hover:shadow-md",d&&"cursor-pointer hover:scale-[1.02]",o),onClick:d,children:[(0,t.jsxs)(R.u,{children:[(0,t.jsx)(R.aJ,{asChild:!0,children:(0,t.jsxs)(T.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(T.ll,{className:"text-sm font-medium",children:a}),(0,t.jsx)("div",{className:"text-".concat(l,"-600"),children:i})]})}),(0,t.jsx)(R._v,{children:(0,t.jsx)("p",{children:r})})]}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"space-y-1",children:(0,t.jsx)("div",{className:"text-2xl font-bold",children:s})}),(0,t.jsx)("div",{className:"h-12 w-32",children:(0,t.jsx)(B.h,{width:"100%",height:"100%",children:(0,t.jsx)(V.w,{data:c,children:(0,t.jsx)(q.x,{type:"monotone",dataKey:"value",stroke:"var(--".concat(l,"-600)"),strokeWidth:2,dot:!1})})})})]})})]})}var Q=s(99376);function L(e){var a;let{open:s,onOpenChange:n,selectedDate:l,selectedSlot:c,preselectedService:m,preselectedVehicleId:x,onDateChange:f,onSlotChange:v,onSave:g,recommendedServiceId:j}=e,{toast:_}=(0,u.pm)(),[y,b]=(0,i.useState)([]),[N,w]=(0,i.useState)([]),[C,S]=(0,i.useState)(""),[Z,E]=(0,i.useState)(""),[z,D]=(0,i.useState)([]),[M,R]=(0,i.useState)(""),[P,F]=(0,i.useState)("pendiente"),[H,A]=(0,i.useState)(""),[T,B]=(0,i.useState)([]),V=(0,k.createClientComponentClient)(),q=(0,Q.useRouter)(),[I,L]=(0,i.useState)(!1),[Y,$]=(0,i.useState)([]),[U,W]=(0,i.useState)([]),[J,X]=(0,i.useState)([]),K=async()=>{try{let[{data:e,error:a},{data:s,error:t},{data:i,error:r}]=await Promise.all([V.from("clientes").select("*").order("nombre"),V.from("vehiculos").select("*").order("marca, modelo"),V.from("servicios").select("*").order("nombre")]);if(a)throw a;if(t)throw t;if(r)throw r;b(e||[]),w(s||[]),B(i||[])}catch(e){_({variant:"destructive",title:"Error",description:"Error al cargar la informaci\xf3n"})}},G=async()=>{let{data:e,error:a}=await V.from("horarios_operacion").select("*").order("dia_semana");a||W(e||[])},ee=async()=>{let{data:e,error:a}=await V.from("fechas_bloqueadas").select("*");a||$(e||[])};(0,i.useEffect)(()=>{if(s){let e=async()=>{let{data:e,error:a}=await V.from("citas").select("\n            *,\n            servicios:servicio_id_uuid (\n              id_uuid,\n              nombre,\n              duracion_estimada\n            ),\n            clientes!citas_cliente_id_uuid_fkey (\n              id_uuid,\n              nombre\n            )\n          ").gte("fecha_hora",new Date().toISOString()).order("fecha_hora");a||X(e||[])};K(),e(),G(),ee()}},[s]),(0,i.useEffect)(()=>{if(s&&N.length>0&&(m&&R(m.id_uuid),x)){let e=N.find(e=>e.id_uuid===x);e&&(E(x),S(e.id_cliente_uuid))}},[s,N,m,x]),(0,i.useEffect)(()=>{C?D(N.filter(e=>e.id_cliente_uuid===C)):D([])},[C,N]);let ea=async e=>{if(e.preventDefault(),!C||!Z||!M||!l||!c){_({variant:"destructive",title:"Error",description:"Por favor complete todos los campos"});return}L(!0);try{let e="".concat(l,"T").concat(c),{data:a,error:s}=await V.from("citas").insert([{cliente_id_uuid:C,vehiculo_id_uuid:Z,servicio_id_uuid:M,fecha_hora:e,estado:P,notas:H,recommended_service_id:j||null}]).select().single();if(s)throw s;if(j){let{error:e}=await V.from("recommended_services").update({status:"scheduled"}).eq("id",j);if(e)throw e;_({title:"Cita agendada",description:"La cita se ha creado y el servicio recomendado ha sido actualizado",duration:5e3})}else _({title:"Cita agendada",description:"La cita se ha creado exitosamente"});n(!1),g(),q.replace("/citas")}catch(e){console.error("Error:",e),_({variant:"destructive",title:"Error",description:"Error al agendar la cita"})}finally{L(!1)}};return(0,t.jsx)(d.Vq,{open:s,onOpenChange:n,children:(0,t.jsxs)(d.cZ,{className:"max-w-4xl",children:[(0,t.jsxs)(d.fK,{children:[(0,t.jsx)(d.$N,{children:"Agendar Nueva Cita"}),(0,t.jsx)(d.Be,{children:"Complete los datos de la cita. Todos los campos son obligatorios."})]}),(0,t.jsxs)("form",{onSubmit:ea,children:[(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(o._,{htmlFor:"cliente",className:"text-right",children:"Cliente"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)(h.Ph,{value:C,onValueChange:S,children:[(0,t.jsx)(h.i4,{children:(0,t.jsx)(h.ki,{placeholder:"Seleccione un cliente"})}),(0,t.jsx)(h.Bw,{children:y.map(e=>(0,t.jsx)(h.Ql,{value:e.id_uuid,children:e.nombre},e.id_uuid))})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(o._,{htmlFor:"vehiculo",className:"text-right",children:"Veh\xedculo"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)(h.Ph,{value:Z,onValueChange:E,disabled:!C,children:[(0,t.jsx)(h.i4,{children:(0,t.jsx)(h.ki,{placeholder:C?"Seleccione un veh\xedculo":"Primero seleccione un cliente"})}),(0,t.jsx)(h.Bw,{children:z.map(e=>(0,t.jsx)(h.Ql,{value:e.id_uuid,children:"".concat(e.marca," ").concat(e.modelo).concat(e.placa?" (".concat(e.placa,")"):"")},e.id_uuid))})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(o._,{htmlFor:"servicio",className:"text-right",children:"Servicio"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)(h.Ph,{value:M,onValueChange:R,children:[(0,t.jsx)(h.i4,{children:(0,t.jsx)(h.ki,{placeholder:"Seleccione un servicio"})}),(0,t.jsx)(h.Bw,{children:T.map(e=>(0,t.jsxs)(h.Ql,{value:e.id_uuid,children:[e.nombre," (",e.duracion_estimada," min)"]},e.id_uuid))})]})})]}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-4 items-start gap-4",children:[(0,t.jsx)(o._,{className:"text-right pt-4",children:"Fecha y Hora"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)("div",{className:"grid grid-cols-[400px,1fr] gap-6",children:[(0,t.jsx)("div",{className:"bg-white rounded-xl border shadow-sm",children:(0,t.jsx)(O,{selectedDate:l?new Date(l):null,onSelect:e=>f((0,p.Z)(e,"yyyy-MM-dd")),blockedDates:Y,operatingHours:U,turnDuration:15,appointments:J,onTimeSlotSelect:e=>v(e.time),selectedService:M?{id:M,duration:(null===(a=T.find(e=>e.id_uuid===M))||void 0===a?void 0:a.duracion_estimada)||0}:void 0})}),(0,t.jsx)("div",{className:"bg-white rounded-xl border shadow-sm",children:(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Horarios disponibles"})})})]})})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(o._,{htmlFor:"estado",className:"text-right",children:"Estado"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)(h.Ph,{value:P,onValueChange:e=>F(e),children:[(0,t.jsx)(h.i4,{children:(0,t.jsx)(h.ki,{placeholder:"Seleccione un estado"})}),(0,t.jsxs)(h.Bw,{children:[(0,t.jsx)(h.Ql,{value:"pendiente",children:"Pendiente"}),(0,t.jsx)(h.Ql,{value:"en_proceso",children:"En Proceso"}),(0,t.jsx)(h.Ql,{value:"completada",children:"Completada"}),(0,t.jsx)(h.Ql,{value:"cancelada",children:"Cancelada"})]})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(o._,{htmlFor:"notas",className:"text-right",children:"Notas"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsx)("textarea",{value:H,onChange:e=>A(e.target.value),placeholder:"Agregue notas adicionales aqu\xed...",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm"})})]})]}),(0,t.jsx)(d.cN,{children:(0,t.jsx)(r.z,{type:"submit",disabled:I,className:"relative",children:I?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"opacity-0",children:"Agendar Cita"}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)("div",{className:"h-5 w-5 animate-spin rounded-full border-b-2 border-white"})})]}):"Agendar Cita"})})]})]})})}var Y=s(63628),$=s(76818);let U="completada",W={es:_.Z};(0,x.lD)({format:p.Z,parse:f.Z,startOfWeek:v.Z,getDay:g.Z,locales:W});let J=e=>{let{open:a,onOpenChange:s,cita:l,onComplete:m}=e,{toast:x}=(0,u.pm)(),[p,f]=(0,i.useState)(null),[v,g]=(0,i.useState)([]),[j,_]=(0,i.useState)(!1),[y,b]=(0,i.useState)([]),N=async()=>{if(0===v.length){x({variant:"destructive",title:"Error",description:"Debe seleccionar al menos un producto utilizado"});return}_(!0);try{let{error:e}=await c.O.from("citas").update({estado:"completada"}).eq("id_uuid",l.id_uuid);if(e)throw e;let{data:a,error:s}=await c.O.from("transacciones_servicio").insert({id_cita:l.id_uuid,estado:"pendiente",fecha_transaccion:new Date().toISOString()}).select().single();if(s)throw s;for(let e of v){let{data:s,error:t}=await c.O.from("productos").select("stock_actual").eq("id_producto",e.id_producto).single();if(t)throw t;let{error:i}=await c.O.from("transaccion_productos").insert({id_transaccion:a.id_transaccion,id_producto:e.id_producto,cantidad_usada:e.cantidad,precio_unitario:e.precio_unitario});if(i)throw i;let{error:r}=await c.O.from("productos").update({stock_actual:s.stock_actual-e.cantidad}).eq("id_producto",e.id_producto);if(r)throw r}if(p&&y.length>0){let e=y.map(e=>({appointment_id:l.id_uuid,vehicle_id:l.vehiculo_id_uuid,service_name:e.service_name,service_description:e.service_description,urgency_level:e.urgency_level,estimated_time:e.estimated_time,estimated_cost:e.estimated_cost,technical_notes:e.technical_notes,status:"pending"})),{error:a}=await c.O.from("recommended_services").insert(e);if(a)throw a}m(),x({title:"Servicio completado",description:"La cita ha sido completada y el inventario actualizado exitosamente"})}catch(e){console.error("Error completo:",e),x({variant:"destructive",title:"Error",description:e.message||"Hubo un error al completar el servicio"})}finally{_(!1)}},w=v.reduce((e,a)=>e+a.cantidad*a.precio_unitario,0);return(0,t.jsx)(d.Vq,{open:a,onOpenChange:s,children:(0,t.jsxs)(d.cZ,{className:"max-w-4xl",children:[(0,t.jsxs)(d.fK,{children:[(0,t.jsx)(d.$N,{children:"Revisi\xf3n Final de Servicio"}),(0,t.jsx)(d.Be,{children:"Complete los detalles del servicio realizado"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Servicios y Productos Utilizados"}),(0,t.jsx)(Y.q,{onSelect:e=>{if(v.find(a=>a.id_producto===e.id_producto)){x({variant:"destructive",title:"Producto ya agregado",description:"Este producto ya fue agregado a la lista"});return}g([...v,e])}}),v.length>0&&(0,t.jsxs)("div",{className:"border rounded-md p-4 space-y-2",children:[v.map(e=>(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:e.nombre}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(n.I,{type:"number",min:"1",className:"w-20",value:e.cantidad,onChange:a=>{let s=Number(a.target.value);g(v.map(a=>a.id_producto===e.id_producto?{...a,cantidad:s,subtotal:s*a.precio_unitario}:a))}}),(0,t.jsxs)("span",{children:["$",e.subtotal]}),(0,t.jsx)(r.z,{variant:"ghost",size:"sm",onClick:()=>{g(v.filter(a=>a.id_producto!==e.id_producto))},children:"Eliminar"})]})]},e.id_producto)),(0,t.jsx)("div",{className:"flex justify-end border-t pt-4 mt-4",children:(0,t.jsxs)("span",{className:"text-lg font-semibold",children:["Total: $",w.toLocaleString()]})})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Servicios Adicionales Detectados"}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)(r.z,{variant:!0===p?"default":"outline",onClick:()=>f(!0),children:"S\xed"}),(0,t.jsx)(r.z,{variant:!1===p?"default":"outline",onClick:()=>f(!1),children:"No"})]}),p&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(r.z,{variant:"outline",onClick:()=>{b([...y,{service_name:"",service_description:"",urgency_level:"medium",estimated_time:0,estimated_cost:0,technical_notes:""}])},className:"w-full",children:"Agregar Servicio Adicional"}),y.map((e,a)=>(0,t.jsxs)("div",{className:"border rounded-md p-4 space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("h4",{className:"font-medium",children:["Servicio Adicional #",a+1]}),(0,t.jsx)(r.z,{variant:"ghost",size:"sm",onClick:()=>{b(y.filter((e,s)=>s!==a))},children:"Eliminar"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o._,{children:"Nombre del Servicio"}),(0,t.jsx)(n.I,{value:e.service_name,onChange:e=>{let s=[...y];s[a].service_name=e.target.value,b(s)}})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o._,{children:"Nivel de Urgencia"}),(0,t.jsxs)(h.Ph,{value:e.urgency_level,onValueChange:e=>{let s=[...y];s[a].urgency_level=e,b(s)},children:[(0,t.jsx)(h.i4,{children:(0,t.jsx)(h.ki,{})}),(0,t.jsxs)(h.Bw,{children:[(0,t.jsx)(h.Ql,{value:"high",children:"Alta"}),(0,t.jsx)(h.Ql,{value:"medium",children:"Media"}),(0,t.jsx)(h.Ql,{value:"low",children:"Baja"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o._,{children:"Tiempo Estimado (minutos)"}),(0,t.jsx)(n.I,{type:"number",value:e.estimated_time,onChange:e=>{let s=[...y];s[a].estimated_time=Number(e.target.value),b(s)}})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o._,{children:"Costo Estimado ($)"}),(0,t.jsx)(n.I,{type:"number",value:e.estimated_cost,onChange:e=>{let s=[...y];s[a].estimated_cost=Number(e.target.value),b(s)}})]}),(0,t.jsxs)("div",{className:"col-span-2 space-y-2",children:[(0,t.jsx)(o._,{children:"Descripci\xf3n"}),(0,t.jsx)($.g,{value:e.service_description,onChange:e=>{let s=[...y];s[a].service_description=e.target.value,b(s)}})]}),(0,t.jsxs)("div",{className:"col-span-2 space-y-2",children:[(0,t.jsx)(o._,{children:"Notas T\xe9cnicas"}),(0,t.jsx)($.g,{value:e.technical_notes,onChange:e=>{let s=[...y];s[a].technical_notes=e.target.value,b(s)}})]})]})]},a))]})]}),(0,t.jsxs)(d.cN,{children:[(0,t.jsx)(r.z,{variant:"outline",onClick:()=>s(!1),children:"Cancelar"}),(0,t.jsx)(r.z,{onClick:N,disabled:j||0===v.length,children:j?"Guardando...":"Guardar y Completar"})]})]})})};function X(){let{toast:e}=(0,u.pm)(),[a,s]=(0,i.useState)([]),[d,o]=(0,i.useState)([]),[c,x]=(0,i.useState)([]),[f,v]=(0,i.useState)(!1),[g,j]=(0,i.useState)(!1),[E,z]=(0,i.useState)({cliente_id_uuid:"",servicio_id_uuid:"",fecha_hora:"",estado:"pendiente",notas:""}),[D,M]=(0,i.useState)("calendario"),[R,P]=(0,i.useState)(""),[F,H]=(0,i.useState)("todos"),A=(0,k.createClientComponentClient)(),[T,B]=(0,i.useState)(15),[V,q]=(0,i.useState)(null),[Y,$]=(0,i.useState)(""),[W,X]=(0,i.useState)([]),[K,G]=(0,i.useState)([]),[ee,ea]=(0,i.useState)(null),[es,et]=(0,i.useState)("service"),[ei,er]=(0,i.useState)(""),[en,el]=(0,i.useState)(!1),[ed,eo]=(0,i.useState)(null),ec=(0,Q.useSearchParams)(),[eu,em]=(0,i.useState)(null),eh=async()=>{try{let{data:e,error:a}=await A.from("clientes").select("id_uuid, nombre");if(a)throw a;let{data:t,error:i}=await A.from("servicios").select("id_uuid, nombre, duracion_estimada");if(i)throw i;let{data:r,error:n}=await A.from("citas").select("\n          id_uuid,\n          cliente_id_uuid,\n          servicio_id_uuid,\n          vehiculo_id_uuid,\n          fecha_hora,\n          estado,\n          notas,\n          created_at,\n          clientes!citas_cliente_id_uuid_fkey (\n            id_uuid,\n            nombre\n          ),\n          servicios!citas_servicio_id_uuid_fkey (\n            id_uuid,\n            nombre,\n            duracion_estimada\n          ),\n          vehiculos!citas_vehiculo_id_uuid_fkey (\n            id_uuid,\n            marca,\n            modelo,\n            placa,\n            id_cliente_uuid\n          )\n        ").order("fecha_hora",{ascending:!0});if(n)throw n;o(e||[]),x(t||[]),s(r||[])}catch(a){console.error("Error al cargar datos:",a),e({variant:"destructive",title:"Error",description:"No se pudieron cargar los datos"})}};(0,i.useEffect)(()=>{eh()},[]),(0,i.useEffect)(()=>{(async()=>{let{data:e,error:a}=await A.from("configuracion_taller").select("duracion_turno").single();!a&&e&&B(e.duracion_turno)})()},[]),(0,i.useEffect)(()=>{let e=async()=>{let{data:e,error:a}=await A.from("fechas_bloqueadas").select("*");a||X(e||[])};(async()=>{let{data:e,error:a}=await A.from("horarios_operacion").select("*").order("dia_semana");a||G(e||[])})(),e()},[]),(0,i.useEffect)(()=>{let e=ec.get("action"),a=ec.get("vehicle_id"),s=ec.get("recommended_service_id");"create"===e&&a&&s&&(async()=>{let{data:e,error:t}=await A.from("recommended_services").select("*").eq("id",s).single();if(!t&&e&&(em(a),v(!0),e.service_name)){let a=c.find(a=>a.nombre.toLowerCase()===e.service_name.toLowerCase());a&&ea(a)}})()},[ec,c]),(0,i.useEffect)(()=>{console.log("Estado actualizado - clientes:",d),console.log("Estado actualizado - servicios:",c)},[d,c]);let ex=a.filter(e=>{let a="todos"===F||e.estado===F,s=!R||e.fecha_hora.startsWith(R);return a&&s}),ep=async(i,n)=>{if(n===U){let e=a.find(e=>e.id_uuid===i)||null;el(!0),eo(e);return}if(await new Promise(e=>{e(window.confirm("\xbfEst\xe1s seguro de que deseas cambiar el estado de la cita a ".concat(n,"?")))}))try{let{data:l,error:d}=await A.from("citas").update({estado:n}).eq("id_uuid",i).select();if(d)throw d;s(a.map(e=>e.id_uuid===i?{...e,estado:n}:e)),"completada"===n?e({title:"Cita completada",description:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{children:"La cita ha sido marcada como completada"}),(0,t.jsx)(r.z,{asChild:!0,children:(0,t.jsx)(Z.default,{href:"/transacciones/nueva?id_cita=".concat(i),children:"Crear Transacci\xf3n"})})]})}):e({title:"Estado actualizado",description:"La cita ha sido marcada como ".concat(n)})}catch(a){e({variant:"destructive",title:"Error",description:"No se pudo actualizar el estado"})}},ef=()=>{let e=a.length,s=a.filter(e=>"pendiente"===e.estado).length;return{total:e,pendiente:s,enProceso:a.filter(e=>"en_proceso"===e.estado).length,completada:a.filter(e=>"completada"===e.estado).length,cancelada:a.filter(e=>"cancelada"===e.estado).length}};return(0,t.jsx)("div",{className:"min-h-screen",children:(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-5",children:[(0,t.jsx)(I,{title:"Total de Citas",value:ef().total,description:"Todas las citas",icon:(0,t.jsx)(b.Z,{className:"h-4 w-4 text-gray-600"}),className:"bg-white"}),(0,t.jsx)(I,{title:"Pendientes",value:ef().pendiente,description:"Citas por atender",icon:(0,t.jsx)(N.Z,{className:"h-4 w-4 text-yellow-600"}),className:"bg-white border-yellow-200"}),(0,t.jsx)(I,{title:"En Proceso",value:ef().enProceso,description:"Citas en curso",icon:(0,t.jsx)(w.Z,{className:"h-4 w-4 text-blue-600"}),className:"bg-white border-blue-200"}),(0,t.jsx)(I,{title:"Completadas",value:ef().completada,description:"Citas finalizadas",icon:(0,t.jsx)(C.Z,{className:"h-4 w-4 text-green-600"}),className:"bg-white border-green-200"}),(0,t.jsx)(I,{title:"Canceladas",value:ef().cancelada,description:"Citas canceladas",icon:(0,t.jsx)(S.Z,{className:"h-4 w-4 text-red-600"}),className:"bg-white border-red-200"})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,t.jsx)("div",{className:"p-4 border-b",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Seleccionar Servicio"}),(0,t.jsxs)(h.Ph,{value:(null==ee?void 0:ee.id_uuid)||"",onValueChange:e=>{ea(c.find(a=>a.id_uuid===e)||null)},children:[(0,t.jsx)(h.i4,{className:"w-[300px]",children:(0,t.jsx)(h.ki,{placeholder:"Seleccione un servicio para agendar"})}),(0,t.jsx)(h.Bw,{children:c.map(e=>(0,t.jsxs)(h.Ql,{value:e.id_uuid,children:[e.nombre," (",e.duracion_estimada," min)"]},e.id_uuid))})]})]})}),(0,t.jsx)(O,{selectedDate:V,onSelect:e=>q(e||null),blockedDates:W,operatingHours:K,turnDuration:T,appointments:a,onTimeSlotSelect:a=>{if(!ee){e({title:"Seleccione un servicio",description:"Debe seleccionar un servicio antes de elegir un horario",variant:"destructive"});return}q(V),$(a.time),v(!0)},selectedService:ee?{id:ee.id_uuid,duration:ee.duracion_estimada}:void 0})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[(0,t.jsx)("h2",{className:"text-lg font-medium",children:"Lista de Citas"}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(n.I,{placeholder:"Buscar citas...",value:ei,onChange:e=>er(e.target.value),className:"w-[300px]"}),(0,t.jsxs)("div",{className:"flex bg-muted rounded-lg p-1",children:[(0,t.jsx)(r.z,{variant:"pendiente"===F?"secondary":"ghost",size:"sm",onClick:()=>H("pendiente"),className:"text-sm",children:"Pendientes"}),(0,t.jsx)(r.z,{variant:"en_proceso"===F?"secondary":"ghost",size:"sm",onClick:()=>H("en_proceso"),className:"text-sm",children:"En Proceso"}),(0,t.jsx)(r.z,{variant:"completada"===F?"secondary":"ghost",size:"sm",onClick:()=>H("completada"),className:"text-sm",children:"Completadas"}),(0,t.jsx)(r.z,{variant:"todos"===F?"secondary":"ghost",size:"sm",onClick:()=>H("todos"),className:"text-sm",children:"Todas"})]})]}),(0,t.jsxs)(l.iA,{children:[(0,t.jsx)(l.xD,{children:(0,t.jsxs)(l.SC,{children:[(0,t.jsx)(l.ss,{children:"Cliente"}),(0,t.jsx)(l.ss,{children:"Servicio"}),(0,t.jsx)(l.ss,{children:"Veh\xedculo"}),(0,t.jsx)(l.ss,{children:"Fecha y Hora"}),(0,t.jsx)(l.ss,{children:"Estado"}),(0,t.jsx)(l.ss,{children:"Notas"}),(0,t.jsx)(l.ss,{className:"text-right",children:"Acciones"})]})}),(0,t.jsxs)(l.RM,{children:[ex.map(e=>{var a,s,i,n,d;return(0,t.jsxs)(l.SC,{children:[(0,t.jsx)(l.pj,{children:null===(a=e.clientes)||void 0===a?void 0:a.nombre}),(0,t.jsx)(l.pj,{children:null===(s=e.servicios)||void 0===s?void 0:s.nombre}),(0,t.jsx)(l.pj,{children:(0,t.jsxs)(Z.default,{href:"/vehiculos?id=".concat(e.vehiculo_id_uuid),className:"text-blue-600 hover:underline",children:[null===(i=e.vehiculos)||void 0===i?void 0:i.marca," ",null===(n=e.vehiculos)||void 0===n?void 0:n.modelo,(null===(d=e.vehiculos)||void 0===d?void 0:d.placa)&&" (".concat(e.vehiculos.placa,")")]})}),(0,t.jsx)(l.pj,{children:(0,p.Z)(new Date(e.fecha_hora),"PPP 'a las' p",{locale:_.Z})}),(0,t.jsx)(l.pj,{children:(0,t.jsx)("span",{className:"inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ".concat("completada"===e.estado?"bg-green-100 text-green-800":"cancelada"===e.estado?"bg-red-100 text-red-800":"en_proceso"===e.estado?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"),children:e.estado})}),(0,t.jsx)(l.pj,{children:e.notas}),(0,t.jsx)(l.pj,{className:"text-right",children:(0,t.jsxs)(y.h_,{children:[(0,t.jsx)(y.$F,{asChild:!0,children:(0,t.jsx)(r.z,{variant:"outline",className:"h-8 px-2 py-0",children:(0,t.jsx)("span",{children:"Cambiar Estado"})})}),(0,t.jsxs)(y.AW,{align:"end",children:[e.estado!==U&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Xi,{onClick:()=>ep(e.id_uuid,"en_proceso"),children:"Iniciar"}),(0,t.jsx)(y.Xi,{onClick:()=>ep(e.id_uuid,U),children:"Completar"}),(0,t.jsx)(y.Xi,{onClick:()=>ep(e.id_uuid,"cancelada"),children:"Cancelar"})]}),e.estado===U&&(0,t.jsx)(y.Xi,{asChild:!0,children:(0,t.jsx)(Z.default,{href:"/transacciones?id_cita=".concat(e.id_uuid),children:"Crear Transacci\xf3n"})})]})]})})]},e.id_uuid)}),0===ex.length&&(0,t.jsx)(l.SC,{children:(0,t.jsx)(l.pj,{colSpan:6,className:"text-center py-4",children:"No hay citas que mostrar"})})]})]})]}),(0,t.jsx)(L,{open:f,onOpenChange:v,selectedDate:V?(0,p.Z)(V,"yyyy-MM-dd"):null,selectedSlot:Y||null,preselectedService:ee,preselectedVehicleId:eu,recommendedServiceId:ec.get("recommended_service_id"),onDateChange:e=>{let a=new Date(e);a.setHours(0,0,0,0),q(a)},onSlotChange:$,onSave:()=>{eh(),ea(null),q(null),$(""),em(null),et("service")}}),(0,t.jsx)(J,{open:en,onOpenChange:el,cita:ed,onComplete:()=>{ed&&(ep(ed.id_uuid,"completada"),el(!1))}}),(0,t.jsx)(m.x,{})]})})}function K(){return(0,t.jsx)("div",{className:"flex-1 p-8",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Citas"}),(0,t.jsx)("p",{className:"text-gray-500 mt-2"})]}),(0,t.jsx)(i.Suspense,{fallback:(0,t.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}),children:(0,t.jsx)(X,{})})]})})}},1098:function(e,a,s){"use strict";s.d(a,{f:function(){return o}});var t=s(57437);s(2265);var i=s(92451),r=s(10407),n=s(65357),l=s(94508),d=s(62869);function o(e){let{className:a,classNames:s,showOutsideDays:o=!0,...c}=e;return(0,t.jsx)(n._W,{showOutsideDays:o,className:(0,l.cn)("p-3",a),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,l.cn)((0,d.d)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:(0,l.cn)("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md","range"===c.mode?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:(0,l.cn)((0,d.d)({variant:"ghost"}),"h-8 w-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start",day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{className:a,...s}=e;return(0,t.jsx)(i.Z,{className:(0,l.cn)("h-4 w-4",a),...s})},IconRight:e=>{let{className:a,...s}=e;return(0,t.jsx)(r.Z,{className:(0,l.cn)("h-4 w-4",a),...s})}},...c})}o.displayName="Calendar"},66070:function(e,a,s){"use strict";s.d(a,{Ol:function(){return l},Zb:function(){return n},aY:function(){return o},ll:function(){return d}});var t=s(57437),i=s(2265),r=s(94508);let n=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)("div",{ref:a,className:(0,r.cn)("rounded-xl border bg-card text-card-foreground shadow",s),...i})});n.displayName="Card";let l=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)("div",{ref:a,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",s),...i})});l.displayName="CardHeader";let d=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)("h3",{ref:a,className:(0,r.cn)("font-semibold leading-none tracking-tight",s),...i})});d.displayName="CardTitle",i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)("p",{ref:a,className:(0,r.cn)("text-sm text-muted-foreground",s),...i})}).displayName="CardDescription";let o=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)("div",{ref:a,className:(0,r.cn)("p-6 pt-0",s),...i})});o.displayName="CardContent"},84190:function(e,a,s){"use strict";s.d(a,{$F:function(){return u},AW:function(){return m},Ju:function(){return x},VD:function(){return p},Xi:function(){return h},h_:function(){return c}});var t=s(57437),i=s(2265),r=s(70085),n=s(10407),l=s(30401),d=s(40519),o=s(94508);let c=r.fC,u=r.xz;r.ZA,r.Uv,r.Tr,r.Ee,i.forwardRef((e,a)=>{let{className:s,inset:i,children:l,...d}=e;return(0,t.jsxs)(r.fF,{ref:a,className:(0,o.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",i&&"pl-8",s),...d,children:[l,(0,t.jsx)(n.Z,{className:"ml-auto"})]})}).displayName=r.fF.displayName,i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(r.tu,{ref:a,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})}).displayName=r.tu.displayName;let m=i.forwardRef((e,a)=>{let{className:s,sideOffset:i=4,...n}=e;return(0,t.jsx)(r.Uv,{children:(0,t.jsx)(r.VY,{ref:a,sideOffset:i,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})})});m.displayName=r.VY.displayName;let h=i.forwardRef((e,a)=>{let{className:s,inset:i,...n}=e;return(0,t.jsx)(r.ck,{ref:a,className:(0,o.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",i&&"pl-8",s),...n})});h.displayName=r.ck.displayName,i.forwardRef((e,a)=>{let{className:s,children:i,checked:n,...d}=e;return(0,t.jsxs)(r.oC,{ref:a,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:n,...d,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(r.wU,{children:(0,t.jsx)(l.Z,{className:"h-4 w-4"})})}),i]})}).displayName=r.oC.displayName,i.forwardRef((e,a)=>{let{className:s,children:i,...n}=e;return(0,t.jsxs)(r.Rk,{ref:a,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(r.wU,{children:(0,t.jsx)(d.Z,{className:"h-2 w-2 fill-current"})})}),i]})}).displayName=r.Rk.displayName;let x=i.forwardRef((e,a)=>{let{className:s,inset:i,...n}=e;return(0,t.jsx)(r.__,{ref:a,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",i&&"pl-8",s),...n})});x.displayName=r.__.displayName;let p=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(r.Z0,{ref:a,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",s),...i})});p.displayName=r.Z0.displayName},53647:function(e,a,s){"use strict";s.d(a,{Bw:function(){return h},DI:function(){return c},Ph:function(){return o},Ql:function(){return p},i4:function(){return m},ki:function(){return u},n5:function(){return x}});var t=s(57437),i=s(2265),r=s(56873),n=s(40875),l=s(30401),d=s(94508);let o=r.fC,c=r.ZA,u=r.B4,m=i.forwardRef((e,a)=>{let{className:s,children:i,...l}=e;return(0,t.jsxs)(r.xz,{ref:a,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...l,children:[i,(0,t.jsx)(r.JO,{asChild:!0,children:(0,t.jsx)(n.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=r.xz.displayName;let h=i.forwardRef((e,a)=>{let{className:s,children:i,position:n="popper",...l}=e;return(0,t.jsx)(r.h_,{children:(0,t.jsx)(r.VY,{ref:a,className:(0,d.cn)("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...l,children:(0,t.jsx)(r.l_,{className:(0,d.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i})})})});h.displayName=r.VY.displayName;let x=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(r.__,{ref:a,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...i})});x.displayName=r.__.displayName;let p=i.forwardRef((e,a)=>{let{className:s,children:i,...n}=e;return(0,t.jsxs)(r.ck,{ref:a,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(r.wU,{children:(0,t.jsx)(l.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(r.eT,{children:i})]})});p.displayName=r.ck.displayName,i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(r.Z0,{ref:a,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",s),...i})}).displayName=r.Z0.displayName},76818:function(e,a,s){"use strict";s.d(a,{g:function(){return n}});var t=s(57437),i=s(2265),r=s(94508);let n=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...i})});n.displayName="Textarea"},81103:function(e,a,s){"use strict";s.d(a,{TooltipProvider:function(){return l},_v:function(){return c},aJ:function(){return o},u:function(){return d}});var t=s(57437),i=s(2265),r=s(61312),n=s(94508);let l=r.zt,d=r.fC,o=r.xz,c=i.forwardRef((e,a)=>{let{className:s,sideOffset:i=4,...l}=e;return(0,t.jsx)(r.VY,{ref:a,sideOffset:i,className:(0,n.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})});c.displayName=r.VY.displayName},63628:function(e,a,s){"use strict";s.d(a,{q:function(){return d}});var t=s(57437),i=s(2265),r=s(53647),n=s(2141),l=s(15863);function d(e){let{onSelect:a}=e,[s,d]=(0,i.useState)([]),[o,c]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{(async()=>{c(!0);try{let{data:e,error:a}=await n.O.from("productos").select("id_producto, nombre, precio, stock_actual").gt("stock_actual",0).order("nombre");if(a)throw a;d(e||[])}catch(e){console.error("Error cargando productos:",e)}finally{c(!1)}})()},[]),(0,t.jsx)("div",{className:"space-y-1",children:(0,t.jsxs)(r.Ph,{onValueChange:e=>{let t=s.find(a=>a.id_producto===e);t&&a({id_producto:t.id_producto,nombre:t.nombre,cantidad:1,precio_unitario:t.precio,subtotal:t.precio})},children:[(0,t.jsxs)(r.i4,{className:"w-full",children:[(0,t.jsx)(r.ki,{placeholder:o?"Cargando productos...":"Seleccione un producto"}),o&&(0,t.jsx)(l.Z,{className:"h-4 w-4 animate-spin"})]}),(0,t.jsx)(r.Bw,{children:(0,t.jsxs)(r.DI,{children:[(0,t.jsx)(r.n5,{className:"text-sm font-medium text-muted-foreground px-2 py-1.5",children:"Productos Disponibles"}),s.map(e=>(0,t.jsxs)(r.Ql,{value:e.id_producto,className:"flex justify-between items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium",children:e.nombre}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Stock: ",e.stock_actual]})]}),(0,t.jsxs)("span",{className:"text-sm font-semibold",children:["$",e.precio.toLocaleString()]})]},e.id_producto)),0===s.length&&!o&&(0,t.jsx)("div",{className:"px-2 py-4 text-sm text-center text-muted-foreground",children:"No hay productos disponibles"})]})})]})})}}},function(e){e.O(0,[1834,2856,6137,3777,8841,6008,1799,6320,7648,5452,51,8385,1218,276,479,1312,5098,7818,2539,4139,2971,2117,1744],function(){return e(e.s=40659)}),_N_E=e.O()}]);