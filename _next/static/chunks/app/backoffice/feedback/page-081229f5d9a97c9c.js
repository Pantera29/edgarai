(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6885],{50850:function(e,t,n){Promise.resolve().then(n.bind(n,61730))},61730:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var r=n(57437),a=n(2265),l=n(10928),s=n(2141),i=n(70236),c=n(89048),o=n(66070),d=n(53647),u=n(31047),f=n(94508),m=n(62869),p=n(1098),h=n(57054);function x(e){let{className:t,value:n,onChange:a}=e;return(0,r.jsx)("div",{className:(0,f.cn)("grid gap-2",t),children:(0,r.jsxs)(h.J2,{children:[(0,r.jsx)(h.xo,{asChild:!0,children:(0,r.jsxs)(m.z,{id:"date",variant:"outline",className:(0,f.cn)("w-[300px] justify-start text-left font-normal",!n&&"text-muted-foreground"),children:[(0,r.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),(null==n?void 0:n.from)?n.to?(0,r.jsxs)(r.Fragment,{children:[(0,i.Z)(n.from,"LLL dd, y",{locale:c.Z})," -"," ",(0,i.Z)(n.to,"LLL dd, y",{locale:c.Z})]}):(0,i.Z)(n.from,"LLL dd, y",{locale:c.Z}):(0,r.jsx)("span",{children:"Seleccionar fechas"})]})}),(0,r.jsx)(h.yk,{className:"w-auto p-0",align:"start",children:(0,r.jsx)(p.f,{initialFocus:!0,mode:"range",defaultMonth:null==n?void 0:n.from,selected:n,onSelect:a,numberOfMonths:2})})]})})}var v=n(35974),N=n(27648),j=n(99376),g=n(66438);let y=[{accessorKey:"created_at",header:"Fecha",cell:e=>{let{row:t}=e;return(0,i.Z)(new Date(t.getValue("created_at")),"PPP",{locale:c.Z})}},{accessorKey:"cliente_nombre",header:"Cliente"},{accessorKey:"estado",header:"Estado",cell:e=>{let{row:t}=e;return(0,r.jsx)(v.C,{variant:"completado"===t.getValue("estado")?"success":"secondary",children:t.getValue("estado")})}},{accessorKey:"puntaje",header:"Puntaje",cell:e=>{let{row:t}=e;return t.getValue("puntaje")?"".concat(t.getValue("puntaje"),"/10"):"-"}},{accessorKey:"clasificacion",header:"Clasificaci\xf3n",cell:e=>{let{row:t}=e,n=t.getValue("clasificacion");return n?(0,r.jsx)(v.C,{variant:"promotor"===n?"success":"neutral"===n?"warning":"destructive",children:n}):"-"}},{accessorKey:"transaccion_id",header:"Transacci\xf3n",cell:e=>{let{row:t}=e;return(0,r.jsx)(N.default,{href:"/transacciones?id=".concat(t.getValue("transaccion_id")),className:"text-primary hover:underline",children:"Ver transacci\xf3n"})}}];function w(){let[e,t]=(0,a.useState)(null),[n,i]=(0,a.useState)(""),[c,u]=(0,a.useState)({}),f=(0,j.useRouter)();(0,a.useEffect)(()=>{t(new URLSearchParams(window.location.search))},[]),(0,a.useEffect)(()=>{if(e){let t=e.get("token");if(t){i(t);let e=(0,g.W)(t);null===e&&f.push("/login"),u(e||{})}}},[e,f]);let[m,p]=(0,a.useState)([]),[h,v]=(0,a.useState)(!0),[N,w]=(0,a.useState)({estado:"todos",dateRange:void 0,clasificacion:"todas"}),b=async()=>{v(!0);try{let e=s.O.from("nps").select("\n          *,\n          transacciones_servicio (\n            citas (\n              clientes (\n                nombre\n              )\n            )\n          )\n        ");"todos"!==N.estado&&(e=e.eq("estado",N.estado)),"todas"!==N.clasificacion&&(e=e.eq("clasificacion",N.clasificacion)),N.dateRange&&(e=(e=e.gte("created_at",N.dateRange.from)).lte("created_at",N.dateRange.to));let{data:t,error:n}=await e;if(n)throw n;let r=t.map(e=>{var t,n,r;return{...e,cliente_nombre:(null===(r=e.transacciones_servicio)||void 0===r?void 0:null===(n=r.citas)||void 0===n?void 0:null===(t=n.clientes)||void 0===t?void 0:t.nombre)||"-"}});p(r)}catch(e){console.error("Error:",e)}finally{v(!1)}};return(0,a.useEffect)(()=>{b()},[N]),(0,r.jsxs)("div",{className:"container mx-auto py-10",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Feedback NPS"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[(0,r.jsx)(o.Zb,{className:"p-4",children:(0,r.jsx)("h3",{className:"font-medium mb-2",children:"NPS Score"})}),(0,r.jsx)(o.Zb,{className:"p-4",children:(0,r.jsx)("h3",{className:"font-medium mb-2",children:"Respuestas Pendientes"})}),(0,r.jsx)(o.Zb,{className:"p-4",children:(0,r.jsx)("h3",{className:"font-medium mb-2",children:"\xdaltima Respuesta"})})]}),(0,r.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,r.jsxs)(d.Ph,{value:N.estado,onValueChange:e=>w(t=>({...t,estado:e})),children:[(0,r.jsx)(d.i4,{className:"w-[180px]",children:(0,r.jsx)(d.ki,{placeholder:"Estado"})}),(0,r.jsxs)(d.Bw,{children:[(0,r.jsx)(d.Ql,{value:"todos",children:"Todos"}),(0,r.jsx)(d.Ql,{value:"pendiente",children:"Pendiente"}),(0,r.jsx)(d.Ql,{value:"completado",children:"Completado"})]})]}),(0,r.jsxs)(d.Ph,{value:N.clasificacion,onValueChange:e=>w(t=>({...t,clasificacion:e})),children:[(0,r.jsx)(d.i4,{className:"w-[180px]",children:(0,r.jsx)(d.ki,{placeholder:"Clasificaci\xf3n"})}),(0,r.jsxs)(d.Bw,{children:[(0,r.jsx)(d.Ql,{value:"todas",children:"Todas"}),(0,r.jsx)(d.Ql,{value:"promotor",children:"Promotor"}),(0,r.jsx)(d.Ql,{value:"neutral",children:"Neutral"}),(0,r.jsx)(d.Ql,{value:"detractor",children:"Detractor"})]})]}),(0,r.jsx)(x,{value:N.dateRange,onChange:e=>w(t=>({...t,dateRange:e}))})]}),(0,r.jsx)("div",{className:"space-y-4",children:h?(0,r.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,r.jsx)("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full"})}):(0,r.jsx)(l.w,{columns:y,data:m})})]})}},66070:function(e,t,n){"use strict";n.d(t,{Ol:function(){return i},Zb:function(){return s},aY:function(){return o},ll:function(){return c}});var r=n(57437),a=n(2265),l=n(94508);let s=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("rounded-xl border bg-card text-card-foreground shadow",n),...a})});s.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",n),...a})});i.displayName="CardHeader";let c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("h3",{ref:t,className:(0,l.cn)("font-semibold leading-none tracking-tight",n),...a})});c.displayName="CardTitle",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",n),...a})}).displayName="CardDescription";let o=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",n),...a})});o.displayName="CardContent"},67822:function(e,t,n){"use strict";n.d(t,{B:function(){return c}});var r=n(2265),a=n(73966),l=n(98575),s=n(37053),i=n(57437);function c(e){let t=e+"CollectionProvider",[n,c]=(0,a.b)(t),[o,d]=n(t,{collectionRef:{current:null},itemMap:new Map}),u=e=>{let{scope:t,children:n}=e,a=r.useRef(null),l=r.useRef(new Map).current;return(0,i.jsx)(o,{scope:t,itemMap:l,collectionRef:a,children:n})};u.displayName=t;let f=e+"CollectionSlot",m=r.forwardRef((e,t)=>{let{scope:n,children:r}=e,a=d(f,n),c=(0,l.e)(t,a.collectionRef);return(0,i.jsx)(s.g7,{ref:c,children:r})});m.displayName=f;let p=e+"CollectionItemSlot",h="data-radix-collection-item",x=r.forwardRef((e,t)=>{let{scope:n,children:a,...c}=e,o=r.useRef(null),u=(0,l.e)(t,o),f=d(p,n);return r.useEffect(()=>(f.itemMap.set(o,{ref:o,...c}),()=>void f.itemMap.delete(o))),(0,i.jsx)(s.g7,{[h]:"",ref:u,children:a})});return x.displayName=p,[{Provider:u,Slot:m,ItemSlot:x},function(t){let n=d(e+"CollectionConsumer",t);return r.useCallback(()=>{let e=n.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll("[".concat(h,"]")));return Array.from(n.itemMap.values()).sort((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current))},[n.collectionRef,n.itemMap])},c]}},29114:function(e,t,n){"use strict";n.d(t,{gm:function(){return l}});var r=n(2265);n(57437);var a=r.createContext(void 0);function l(e){let t=r.useContext(a);return e||t||"ltr"}},71599:function(e,t,n){"use strict";n.d(t,{z:function(){return s}});var r=n(2265),a=n(98575),l=n(61188),s=e=>{var t,n;let s,c;let{present:o,children:d}=e,u=function(e){var t,n;let[a,s]=r.useState(),c=r.useRef({}),o=r.useRef(e),d=r.useRef("none"),[u,f]=(t=e?"mounted":"unmounted",n={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},r.useReducer((e,t)=>{let r=n[e][t];return null!=r?r:e},t));return r.useEffect(()=>{let e=i(c.current);d.current="mounted"===u?e:"none"},[u]),(0,l.b)(()=>{let t=c.current,n=o.current;if(n!==e){let r=d.current,a=i(t);e?f("MOUNT"):"none"===a||(null==t?void 0:t.display)==="none"?f("UNMOUNT"):n&&r!==a?f("ANIMATION_OUT"):f("UNMOUNT"),o.current=e}},[e,f]),(0,l.b)(()=>{if(a){var e;let t;let n=null!==(e=a.ownerDocument.defaultView)&&void 0!==e?e:window,r=e=>{let r=i(c.current).includes(e.animationName);if(e.target===a&&r&&(f("ANIMATION_END"),!o.current)){let e=a.style.animationFillMode;a.style.animationFillMode="forwards",t=n.setTimeout(()=>{"forwards"===a.style.animationFillMode&&(a.style.animationFillMode=e)})}},l=e=>{e.target===a&&(d.current=i(c.current))};return a.addEventListener("animationstart",l),a.addEventListener("animationcancel",r),a.addEventListener("animationend",r),()=>{n.clearTimeout(t),a.removeEventListener("animationstart",l),a.removeEventListener("animationcancel",r),a.removeEventListener("animationend",r)}}f("ANIMATION_END")},[a,f]),{isPresent:["mounted","unmountSuspended"].includes(u),ref:r.useCallback(e=>{e&&(c.current=getComputedStyle(e)),s(e)},[])}}(o),f="function"==typeof d?d({present:u.isPresent}):r.Children.only(d),m=(0,a.e)(u.ref,(s=null===(t=Object.getOwnPropertyDescriptor(f.props,"ref"))||void 0===t?void 0:t.get)&&"isReactWarning"in s&&s.isReactWarning?f.ref:(s=null===(n=Object.getOwnPropertyDescriptor(f,"ref"))||void 0===n?void 0:n.get)&&"isReactWarning"in s&&s.isReactWarning?f.props.ref:f.props.ref||f.ref);return"function"==typeof d||u.isPresent?r.cloneElement(f,{ref:m}):null};function i(e){return(null==e?void 0:e.animationName)||"none"}s.displayName="Presence"}},function(e){e.O(0,[8218,6137,3777,8841,3314,6008,5055,2130,7648,464,51,4973,8996,2971,2117,1744],function(){return e(e.s=50850)}),_N_E=e.O()}]);