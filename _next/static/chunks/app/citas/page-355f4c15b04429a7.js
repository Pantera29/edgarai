(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[410],{91673:function(e,a,s){Promise.resolve().then(s.bind(s,30403))},30403:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return L}});var t=s(57437),i=s(2265),r=s(62869),l=s(95186),n=s(73578),d=s(77992),o=s(849),c=s(53647),u=s(45727),m=s(70236),h=s(53178),x=s(71344),p=s(35613),f=s(24298),g=s(89048);s(87676);var j=s(84190),v=s(31047),y=s(91723),b=s(22252),_=s(66901),N=s(45131),w=s(56266),C=s(95452),S=s(27648),Z=s(1098),k=s(71878),E=s(6639),M=s(94508),D=s(81103),z=s(43643);i.forwardRef((e,a)=>{let{className:s,children:i,...r}=e;return(0,t.jsxs)(z.fC,{ref:a,className:(0,M.cn)("relative overflow-hidden",s),...r,children:[(0,t.jsx)(z.l_,{className:"h-full w-full rounded-[inherit]",children:i}),(0,t.jsx)(P,{}),(0,t.jsx)(z.Ns,{})]})}).displayName=z.fC.displayName;let P=i.forwardRef((e,a)=>{let{className:s,orientation:i="vertical",...r}=e;return(0,t.jsx)(z.gb,{ref:a,orientation:i,className:(0,M.cn)("flex touch-none select-none transition-colors","vertical"===i&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===i&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...r,children:(0,t.jsx)(z.q4,{className:"relative flex-1 rounded-full bg-border"})})});P.displayName=z.gb.displayName;let F=e=>{let{date:a,dayInfo:s,onClick:i,disabled:r,isSelected:l}=e,n="w-8 h-8 p-0 font-normal relative text-sm flex items-center justify-center rounded-md";return r?(0,t.jsx)("button",{disabled:!0,className:(0,M.cn)(n,"text-muted-foreground opacity-50"),children:(0,t.jsx)("time",{dateTime:(0,m.Z)(a,"yyyy-MM-dd"),children:(0,m.Z)(a,"d")})}):(0,t.jsx)("button",{onClick:i,className:(0,M.cn)(n,"transition-colors",l&&"ring-2 ring-primary ring-offset-2 bg-primary text-primary-foreground",!l&&"hover:bg-accent hover:text-accent-foreground",s.isFullyBlocked?"bg-[#F3F4F6] text-gray-500":"high"===s.status?"bg-[#E6F4EA] text-green-700":"medium"===s.status?"bg-[#FEF3C7] text-yellow-700":"bg-[#FEE2E2] text-red-700"),children:(0,t.jsx)("time",{dateTime:(0,m.Z)(a,"yyyy-MM-dd"),children:(0,m.Z)(a,"d")})})},R=()=>(0,t.jsxs)("div",{className:"flex justify-center gap-6 text-xs mt-4 px-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 rounded bg-[#E6F4EA]"}),(0,t.jsx)("span",{children:"Disponible"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 rounded bg-yellow-50"}),(0,t.jsx)("span",{children:"Moderado"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 rounded bg-[#FEE2E2]"}),(0,t.jsx)("span",{children:"Limitado"})]})]});function H(e){let{selectedDate:a,onSelect:s,blockedDates:l,operatingHours:n,turnDuration:d,appointments:o,onTimeSlotSelect:c,selectedService:u}=e,[x,p]=(0,i.useState)([]),[j,y]=(0,i.useState)(!1),[b,_]=(0,i.useState)(new Date),[N,w]=(0,i.useState)(null),C=(0,i.useRef)(null),S=e=>{let a=0===e.getDay()?1:e.getDay()+1,s=n.find(e=>e.dia_semana===a),t=(0,m.Z)(e,"yyyy-MM-dd"),i=l.find(e=>e.fecha===t);if(!s||!s.es_dia_laboral)return{percentage:0,status:"blocked",totalSlots:0,availableSlots:0,isFullyBlocked:!0,isPartiallyBlocked:!1,blockReason:"D\xeda no laborable"};if(null==i?void 0:i.dia_completo)return{percentage:0,status:"blocked",totalSlots:0,availableSlots:0,isFullyBlocked:!0,isPartiallyBlocked:!1,blockReason:i.motivo};let r=!!i&&!i.dia_completo,c=(0,h.Z)(s.hora_apertura,"HH:mm:ss",e),u=Math.floor(((0,h.Z)(s.hora_cierre,"HH:mm:ss",e).getTime()-c.getTime())/6e4/d)*s.servicios_simultaneos_max,x=o.filter(e=>(0,m.Z)(new Date(e.fecha_hora),"yyyy-MM-dd")===t).reduce((e,a)=>e+Math.ceil(a.servicios.duracion_estimada/d),0),p=(u-x)/u*100,f=100-p;return{percentage:p,status:f>80?"low":f>50?"medium":"high",totalSlots:u,availableSlots:u-x,nextAvailable:void 0,peakHours:void 0,isFullyBlocked:!1,isPartiallyBlocked:r,blockReason:null==i?void 0:i.motivo}},z=e=>{let a=0===e.getDay()?1:e.getDay()+1,s=n.find(e=>e.dia_semana===a);if(!s||!s.es_dia_laboral)return[];let t=[],i=(0,h.Z)(s.hora_apertura,"HH:mm:ss",e),r=(0,h.Z)(s.hora_cierre,"HH:mm:ss",e),l=(0,m.Z)(e,"yyyy-MM-dd"),c=o.filter(e=>(0,m.Z)(new Date(e.fecha_hora),"yyyy-MM-dd")===l),u=i;for(;u<r;){let a=(0,m.Z)(u,"HH:mm"),i=P(e,a),r=c.filter(e=>{let s=(0,m.Z)(new Date(e.fecha_hora),"HH:mm"),t=(0,m.Z)((0,f.Z)(new Date(e.fecha_hora),e.servicios.duracion_estimada),"HH:mm");return a>=s&&a<t}),l=r.length,n=i?0:Math.max(0,s.servicios_simultaneos_max-l);t.push({time:a,available:n,isBlocked:i,blockReason:i?H(e,a):void 0,existingAppointments:r.map(e=>({id:e.id_uuid,clientName:e.clientes.nombre,serviceName:e.servicios.nombre,duration:e.servicios.duracion_estimada}))}),u=(0,f.Z)(u,d)}return t},P=(e,a)=>{let s=(0,m.Z)(e,"yyyy-MM-dd"),t=l.find(e=>e.fecha===s);return!!t&&(!!t.dia_completo||!!t.hora_inicio&&!!t.hora_fin&&a>=t.hora_inicio&&a<=t.hora_fin)},H=(e,a)=>{let s=(0,m.Z)(e,"yyyy-MM-dd"),t=l.find(e=>e.fecha===s);return(null==t?void 0:t.motivo)||"Horario no disponible"};return(0,i.useEffect)(()=>{a&&p(z(a))},[a,n,l,d]),(0,t.jsx)("div",{className:"h-full p-1",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-[0.6fr,1.4fr] gap-8",children:[(0,t.jsx)("div",{className:"w-full flex justify-center",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl border shadow-sm space-y-4 w-full max-w-[350px]",children:[(0,t.jsx)("div",{className:"p-4 border-b",children:(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Calendario de disponibilidad"})}),(0,t.jsx)("div",{className:"flex justify-center px-2 py-4",children:(0,t.jsx)("div",{className:"w-fit",children:(0,t.jsx)(Z.f,{mode:"single",selected:a||void 0,onSelect:e=>{e&&!(0,k.Z)(e,(0,E.Z)(new Date))&&s(e)},month:b,onMonthChange:_,locale:g.Z,components:{Day:e=>{let{date:i}=e;return(0,t.jsx)(F,{date:i,dayInfo:S(i),onClick:()=>{(0,k.Z)(i,(0,E.Z)(new Date))||s(i)},disabled:(0,k.Z)(i,(0,E.Z)(new Date)),isSelected:!!a&&(0,m.Z)(i,"yyyy-MM-dd")===(0,m.Z)(a,"yyyy-MM-dd")})}},className:"[&_.rdp-months]:flex [&_.rdp-months]:justify-center [&_.rdp-day]:h-8 [&_.rdp-day]:w-8 [&_.rdp-day_button]:h-8 [&_.rdp-day_button]:w-8 [&_.rdp-head_cell]:text-sm [&_.rdp-cell]:p-0"})})}),(0,t.jsx)("div",{className:"pb-4",children:(0,t.jsx)(R,{})})]})}),(0,t.jsx)("div",{className:"lg:pl-0",children:a?(0,t.jsxs)("div",{ref:C,className:"space-y-6",children:[(0,t.jsx)("div",{className:"bg-white rounded-xl border shadow-sm p-4",children:(0,t.jsxs)("h3",{className:"text-lg font-medium",children:["Horarios disponibles para ",(0,m.Z)(a,"EEEE d 'de' MMMM",{locale:g.Z})]})}),(0,t.jsx)("div",{className:"bg-white rounded-xl border shadow-sm",children:a&&x.length?(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:x.map((e,s)=>{var i;let l=e.isBlocked,n=e.time===N,d=e.existingAppointments&&e.existingAppointments.length>0;return(0,t.jsxs)(r.z,{variant:"outline",className:(0,M.cn)("h-auto py-4 relative group transition-all",l?"bg-red-50 text-red-700 border-red-200 hover:bg-red-50":0===e.available?"bg-yellow-50 text-yellow-700 border-yellow-200 hover:bg-yellow-50":n?"bg-primary/20 border-primary ring-2 ring-primary ring-offset-1":"bg-green-50 text-green-700 border-green-200 hover:bg-green-100 hover:border-green-400"),disabled:l||!u||0===e.available,onClick:()=>{(0,k.Z)(a,(0,E.Z)(new Date))||(c&&c(e),w(e.time))},children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsx)("span",{className:"text-base font-semibold",children:e.time}),(0,t.jsxs)("span",{className:"text-xs font-medium",children:[e.available," ",1===e.available?"espacio":"espacios"]})]}),(0,t.jsx)(D.TooltipProvider,{children:(0,t.jsxs)(D.u,{children:[(0,t.jsx)(D.aJ,{asChild:!0,children:(0,t.jsx)("div",{className:"absolute inset-0"})}),(0,t.jsx)(D._v,{side:"top",className:"w-64",children:(0,t.jsx)("div",{className:"space-y-2",children:l?(0,t.jsx)("p",{className:"text-red-600",children:e.blockReason}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{className:"font-medium",children:[e.available," ",1===e.available?"espacio disponible":"espacios disponibles"]}),d&&(0,t.jsxs)("div",{className:"text-sm space-y-1",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Citas agendadas:"}),null===(i=e.existingAppointments)||void 0===i?void 0:i.map((e,a)=>(0,t.jsx)("div",{className:"flex items-center gap-1",children:(0,t.jsx)("span",{children:e.serviceName})},a))]})]})})})]})})]},s)})})}):null})]}):(0,t.jsx)("div",{className:"h-full flex items-center justify-center p-8 bg-white rounded-xl border shadow-sm text-muted-foreground",children:(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)(v.Z,{className:"w-12 h-12 mx-auto text-muted-foreground/50"}),(0,t.jsx)("p",{children:"Seleccione una fecha para ver los horarios disponibles"})]})})})]})})}var B=s(66070),A=s(47625),T=s(21156),V=s(54061);function Q(e){let{title:a,value:s,icon:i,description:r,trend:l=[],color:n="slate",onClick:d,className:o}=e,c=l.map(e=>({value:e}));return(0,t.jsxs)(B.Zb,{className:(0,M.cn)("transition-all duration-200 hover:shadow-md",d&&"cursor-pointer hover:scale-[1.02]",o),onClick:d,children:[(0,t.jsxs)(D.u,{children:[(0,t.jsx)(D.aJ,{asChild:!0,children:(0,t.jsxs)(B.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(B.ll,{className:"text-sm font-medium",children:a}),(0,t.jsx)("div",{className:"text-".concat(n,"-600"),children:i})]})}),(0,t.jsx)(D._v,{children:(0,t.jsx)("p",{children:r})})]}),(0,t.jsx)(B.aY,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"space-y-1",children:(0,t.jsx)("div",{className:"text-2xl font-bold",children:s})}),(0,t.jsx)("div",{className:"h-12 w-32",children:(0,t.jsx)(A.h,{width:"100%",height:"100%",children:(0,t.jsx)(T.w,{data:c,children:(0,t.jsx)(V.x,{type:"monotone",dataKey:"value",stroke:"var(--".concat(n,"-600)"),strokeWidth:2,dot:!1})})})})]})})]})}var O=s(26110),I=s(26815);function q(e){let{open:a,onOpenChange:s,selectedDate:l,selectedSlot:n,onDateChange:o,onSlotChange:u,onSave:h,preselectedService:x}=e,{toast:p}=(0,d.pm)(),[f,j]=(0,i.useState)([]),[v,y]=(0,i.useState)([]),[b,_]=(0,i.useState)(""),[N,w]=(0,i.useState)(""),[S,Z]=(0,i.useState)([]),[k,E]=(0,i.useState)(""),[M,D]=(0,i.useState)("pendiente"),[z,P]=(0,i.useState)(""),[F,R]=(0,i.useState)([]),H=(0,C.createClientComponentClient)(),[B,A]=(0,i.useState)(!1),[T,V]=(0,i.useState)("");(0,i.useEffect)(()=>{let e=async()=>{console.log("Iniciando carga de datos...");try{let{data:e,error:a}=await H.from("clientes").select("*").order("nombre");if(console.log("Clientes cargados:",e),a)throw a;j(e||[]),console.log("Intentando cargar veh\xedculos...");let{data:s,error:t}=await H.from("vehiculos").select("*").order("marca, modelo");if(console.log("Respuesta de veh\xedculos:",{data:s,error:t}),t)throw t;y(s||[]);let{data:i,error:r}=await H.from("servicios").select("*").order("nombre");if(console.log("Servicios cargados:",i),r)throw r;R(i||[])}catch(e){console.error("Error detallado al cargar datos:",e),p({variant:"destructive",title:"Error",description:"Error al cargar la informaci\xf3n"})}};a&&(console.log("Modal abierto, iniciando carga..."),e(),x&&E(x.id_uuid))},[a,x]),(0,i.useEffect)(()=>{if(b){let e=v.filter(e=>e.id_cliente_uuid===b);console.log("Veh\xedculos filtrados:",e),Z(e),w("")}else Z([]),w("")},[b,v]);let Q=async e=>{if(e.preventDefault(),!b||!N||!k||!l||!n){p({variant:"destructive",title:"Error",description:"Por favor complete todos los campos"});return}try{let e="".concat(l,"T").concat(n),{data:a,error:t}=await H.from("citas").insert([{cliente_id_uuid:b,vehiculo_id_uuid:N,servicio_id_uuid:k,fecha_hora:e,estado:M,notas:z}]).select().single();if(t)throw t;a&&V(a.id_cita),p({title:"\xc9xito",description:"Cita agendada correctamente"}),h(),s(!1)}catch(e){console.error("Error al guardar la cita:",e),p({variant:"destructive",title:"Error",description:"Error al agendar la cita"})}};return console.log("Estado actual:",{clientes:f,vehiculos:v,servicios:F,selectedClient:b,selectedVehicle:N}),(0,t.jsx)(O.Vq,{open:a,onOpenChange:s,children:(0,t.jsxs)(O.cZ,{children:[(0,t.jsxs)(O.fK,{children:[(0,t.jsx)(O.$N,{children:"Agendar Nueva Cita"}),(0,t.jsx)(O.Be,{children:"Complete los datos de la cita. Todos los campos son obligatorios."})]}),(0,t.jsxs)("form",{onSubmit:Q,children:[(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(I._,{htmlFor:"cliente",className:"text-right",children:"Cliente"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)(c.Ph,{value:b,onValueChange:_,children:[(0,t.jsx)(c.i4,{children:(0,t.jsx)(c.ki,{placeholder:"Seleccione un cliente"})}),(0,t.jsx)(c.Bw,{children:f.map(e=>(0,t.jsx)(c.Ql,{value:e.id_uuid,children:e.nombre},e.id_uuid))})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(I._,{htmlFor:"vehiculo",className:"text-right",children:"Veh\xedculo"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)(c.Ph,{value:N,onValueChange:w,disabled:!b,children:[(0,t.jsx)(c.i4,{children:(0,t.jsx)(c.ki,{placeholder:b?"Seleccione un veh\xedculo":"Primero seleccione un cliente"})}),(0,t.jsx)(c.Bw,{children:S.map(e=>(0,t.jsx)(c.Ql,{value:e.id_uuid,children:"".concat(e.marca," ").concat(e.modelo).concat(e.placa?" (".concat(e.placa,")"):"")},e.id_uuid))})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(I._,{htmlFor:"servicio",className:"text-right",children:"Servicio"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)(c.Ph,{value:k,onValueChange:E,children:[(0,t.jsx)(c.i4,{children:(0,t.jsx)(c.ki,{placeholder:"Seleccione un servicio"})}),(0,t.jsx)(c.Bw,{children:F.map(e=>(0,t.jsxs)(c.Ql,{value:e.id_uuid,children:[e.nombre," (",e.duracion_estimada," min)"]},e.id_uuid))})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(I._,{className:"text-right",children:"Fecha y Hora"}),(0,t.jsx)("div",{className:"col-span-3 space-y-2",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(c.Ph,{value:l||"",onValueChange:o,children:[(0,t.jsx)(c.i4,{className:"w-[180px]",children:(0,t.jsx)(c.ki,{placeholder:"Seleccione fecha"})}),(0,t.jsx)(c.Bw,{children:Array.from({length:7},(e,a)=>{let s=new Date;return s.setDate(s.getDate()+a),(0,t.jsx)(c.Ql,{value:(0,m.Z)(s,"yyyy-MM-dd"),children:(0,m.Z)(s,"EEEE d MMM",{locale:g.Z})},a)})})]}),(0,t.jsxs)(c.Ph,{value:n||"",onValueChange:u,disabled:!l,children:[(0,t.jsx)(c.i4,{className:"w-[180px]",children:(0,t.jsx)(c.ki,{placeholder:"Seleccione hora"})}),(0,t.jsx)(c.Bw,{children:Array.from({length:40},(e,a)=>{let s=Math.floor(a/4)+8,i=a%4*15,r="".concat(s.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0"));return(0,t.jsx)(c.Ql,{value:r,children:r},a)})})]})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(I._,{htmlFor:"estado",className:"text-right",children:"Estado"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsxs)(c.Ph,{value:M,onValueChange:e=>D(e),children:[(0,t.jsx)(c.i4,{children:(0,t.jsx)(c.ki,{placeholder:"Seleccione un estado"})}),(0,t.jsxs)(c.Bw,{children:[(0,t.jsx)(c.Ql,{value:"pendiente",children:"Pendiente"}),(0,t.jsx)(c.Ql,{value:"en_proceso",children:"En Proceso"}),(0,t.jsx)(c.Ql,{value:"completada",children:"Completada"}),(0,t.jsx)(c.Ql,{value:"cancelada",children:"Cancelada"})]})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,t.jsx)(I._,{htmlFor:"notas",className:"text-right",children:"Notas"}),(0,t.jsx)("div",{className:"col-span-3",children:(0,t.jsx)("textarea",{value:z,onChange:e=>P(e.target.value),placeholder:"Agregue notas adicionales aqu\xed...",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm"})})]})]}),(0,t.jsx)(O.cN,{children:(0,t.jsx)(r.z,{type:"submit",children:"Agendar Cita"})})]})]})})}let Y={es:g.Z};function L(){let{toast:e}=(0,d.pm)(),[a,s]=(0,i.useState)([]),[u,h]=(0,i.useState)([]),[x,p]=(0,i.useState)([]),[f,Z]=(0,i.useState)(!1),[k,E]=(0,i.useState)(!1),[M,D]=(0,i.useState)({cliente_id_uuid:"",servicio_id_uuid:"",fecha_hora:"",estado:"pendiente",notas:""}),[z,P]=(0,i.useState)("calendario"),[F,R]=(0,i.useState)(""),[B,A]=(0,i.useState)("todos"),T=(0,C.createClientComponentClient)(),[V,O]=(0,i.useState)(15),[I,Y]=(0,i.useState)(null),[L,W]=(0,i.useState)(""),[J,X]=(0,i.useState)([]),[K,$]=(0,i.useState)([]),[U,G]=(0,i.useState)(null),[ee,ea]=(0,i.useState)("service"),[es,et]=(0,i.useState)(""),ei=async()=>{try{let{data:e,error:a}=await T.from("clientes").select("id_uuid, nombre");if(a)throw a;let{data:t,error:i}=await T.from("servicios").select("id_uuid, nombre, duracion_estimada");if(i)throw i;let{data:r,error:l}=await T.from("citas").select("\n          id_uuid,\n          cliente_id_uuid,\n          servicio_id_uuid,\n          vehiculo_id_uuid,\n          fecha_hora,\n          estado,\n          notas,\n          created_at,\n          clientes!citas_cliente_id_uuid_fkey (\n            id_uuid,\n            nombre\n          ),\n          servicios!citas_servicio_id_uuid_fkey (\n            id_uuid,\n            nombre,\n            duracion_estimada\n          ),\n          vehiculos!citas_vehiculo_id_uuid_fkey (\n            id_uuid,\n            marca,\n            modelo,\n            placa,\n            id_cliente_uuid\n          )\n        ").order("fecha_hora",{ascending:!0});if(l)throw l;h(e||[]),p(t||[]),s(r||[])}catch(a){console.error("Error al cargar datos:",a),e({variant:"destructive",title:"Error",description:"No se pudieron cargar los datos"})}};(0,i.useEffect)(()=>{ei()},[]),(0,i.useEffect)(()=>{(async()=>{let{data:e,error:a}=await T.from("configuracion_taller").select("duracion_turno").single();!a&&e&&O(e.duracion_turno)})()},[]),(0,i.useEffect)(()=>{let e=async()=>{let{data:e,error:a}=await T.from("fechas_bloqueadas").select("*");a||X(e||[])};(async()=>{let{data:e,error:a}=await T.from("horarios_operacion").select("*").order("dia_semana");a||$(e||[])})(),e()},[]),(0,i.useEffect)(()=>{console.log("Estado actualizado - clientes:",u),console.log("Estado actualizado - servicios:",x)},[u,x]);let er=a.filter(e=>{let a="todos"===B||e.estado===B,s=!F||e.fecha_hora.startsWith(F);return a&&s}),el=async(i,l)=>{if(await new Promise(e=>{e(window.confirm("\xbfEst\xe1s seguro de que deseas cambiar el estado de la cita a ".concat(l,"?")))}))try{let{data:n,error:d}=await T.from("citas").update({estado:l}).eq("id_uuid",i).select();if(d)throw d;s(a.map(e=>e.id_uuid===i?{...e,estado:l}:e)),"completada"===l?e({title:"Cita completada",description:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{children:"La cita ha sido marcada como completada"}),(0,t.jsx)(r.z,{asChild:!0,children:(0,t.jsx)(S.default,{href:"/transacciones/nueva?id_cita=".concat(i),children:"Crear Transacci\xf3n"})})]})}):e({title:"Estado actualizado",description:"La cita ha sido marcada como ".concat(l)})}catch(a){e({variant:"destructive",title:"Error",description:"No se pudo actualizar el estado"})}},en=()=>{let e=a.length,s=a.filter(e=>"pendiente"===e.estado).length;return{total:e,pendiente:s,enProceso:a.filter(e=>"en_proceso"===e.estado).length,completada:a.filter(e=>"completada"===e.estado).length,cancelada:a.filter(e=>"cancelada"===e.estado).length}};return(0,t.jsx)("div",{className:"min-h-screen bg-gray-100",children:(0,t.jsxs)("div",{className:"container mx-auto py-6 space-y-8",children:[(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-5",children:[(0,t.jsx)(Q,{title:"Total de Citas",value:en().total,description:"Todas las citas",icon:(0,t.jsx)(v.Z,{className:"h-4 w-4 text-gray-600"}),className:"bg-white"}),(0,t.jsx)(Q,{title:"Pendientes",value:en().pendiente,description:"Citas por atender",icon:(0,t.jsx)(y.Z,{className:"h-4 w-4 text-yellow-600"}),className:"bg-white border-yellow-200"}),(0,t.jsx)(Q,{title:"En Proceso",value:en().enProceso,description:"Citas en curso",icon:(0,t.jsx)(b.Z,{className:"h-4 w-4 text-blue-600"}),className:"bg-white border-blue-200"}),(0,t.jsx)(Q,{title:"Completadas",value:en().completada,description:"Citas finalizadas",icon:(0,t.jsx)(_.Z,{className:"h-4 w-4 text-green-600"}),className:"bg-white border-green-200"}),(0,t.jsx)(Q,{title:"Canceladas",value:en().cancelada,description:"Citas canceladas",icon:(0,t.jsx)(N.Z,{className:"h-4 w-4 text-red-600"}),className:"bg-white border-red-200"})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,t.jsx)("div",{className:"p-4 border-b",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Seleccionar Servicio"}),(0,t.jsxs)(c.Ph,{value:(null==U?void 0:U.id_uuid)||"",onValueChange:e=>{G(x.find(a=>a.id_uuid===e)||null)},children:[(0,t.jsx)(c.i4,{className:"w-[300px]",children:(0,t.jsx)(c.ki,{placeholder:"Seleccione un servicio para agendar"})}),(0,t.jsx)(c.Bw,{children:x.map(e=>(0,t.jsxs)(c.Ql,{value:e.id_uuid,children:[e.nombre," (",e.duracion_estimada," min)"]},e.id_uuid))})]})]})}),(0,t.jsx)(H,{selectedDate:I,onSelect:e=>Y(e||null),blockedDates:J,operatingHours:K,turnDuration:V,appointments:a,onTimeSlotSelect:a=>{if(!U){e({title:"Seleccione un servicio",description:"Debe seleccionar un servicio antes de elegir un horario",variant:"destructive"});return}Y(I),W(a.time),Z(!0)},selectedService:U?{id:U.id_uuid,duration:U.duracion_estimada}:void 0})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[(0,t.jsx)("h2",{className:"text-lg font-medium",children:"Lista de Citas"}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(l.I,{placeholder:"Buscar citas...",value:es,onChange:e=>et(e.target.value),className:"w-[300px]"}),(0,t.jsxs)("div",{className:"flex bg-muted rounded-lg p-1",children:[(0,t.jsx)(r.z,{variant:"pendiente"===B?"secondary":"ghost",size:"sm",onClick:()=>A("pendiente"),className:"text-sm",children:"Pendientes"}),(0,t.jsx)(r.z,{variant:"en_proceso"===B?"secondary":"ghost",size:"sm",onClick:()=>A("en_proceso"),className:"text-sm",children:"En Proceso"}),(0,t.jsx)(r.z,{variant:"completada"===B?"secondary":"ghost",size:"sm",onClick:()=>A("completada"),className:"text-sm",children:"Completadas"}),(0,t.jsx)(r.z,{variant:"todos"===B?"secondary":"ghost",size:"sm",onClick:()=>A("todos"),className:"text-sm",children:"Todas"})]})]}),(0,t.jsxs)(n.iA,{children:[(0,t.jsx)(n.xD,{children:(0,t.jsxs)(n.SC,{children:[(0,t.jsx)(n.ss,{children:"Cliente"}),(0,t.jsx)(n.ss,{children:"Servicio"}),(0,t.jsx)(n.ss,{children:"Veh\xedculo"}),(0,t.jsx)(n.ss,{children:"Fecha y Hora"}),(0,t.jsx)(n.ss,{children:"Estado"}),(0,t.jsx)(n.ss,{children:"Notas"}),(0,t.jsx)(n.ss,{className:"text-right",children:"Acciones"})]})}),(0,t.jsxs)(n.RM,{children:[er.map(e=>{var a,s,i,l,d;return(0,t.jsxs)(n.SC,{children:[(0,t.jsx)(n.pj,{children:null===(a=e.clientes)||void 0===a?void 0:a.nombre}),(0,t.jsx)(n.pj,{children:null===(s=e.servicios)||void 0===s?void 0:s.nombre}),(0,t.jsx)(n.pj,{children:(0,t.jsxs)(S.default,{href:"/vehiculos?id=".concat(e.vehiculo_id_uuid),className:"text-blue-600 hover:underline",children:[null===(i=e.vehiculos)||void 0===i?void 0:i.marca," ",null===(l=e.vehiculos)||void 0===l?void 0:l.modelo,(null===(d=e.vehiculos)||void 0===d?void 0:d.placa)&&" (".concat(e.vehiculos.placa,")")]})}),(0,t.jsx)(n.pj,{children:(0,m.Z)(new Date(e.fecha_hora),"PPP 'a las' p",{locale:g.Z})}),(0,t.jsx)(n.pj,{children:(0,t.jsx)("span",{className:"inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ".concat("completada"===e.estado?"bg-green-100 text-green-800":"cancelada"===e.estado?"bg-red-100 text-red-800":"en_proceso"===e.estado?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"),children:e.estado})}),(0,t.jsx)(n.pj,{children:e.notas}),(0,t.jsx)(n.pj,{className:"text-right",children:(0,t.jsxs)(j.h_,{children:[(0,t.jsx)(j.$F,{asChild:!0,children:(0,t.jsx)(r.z,{variant:"ghost",className:"h-8 w-8 p-0",children:(0,t.jsx)(w.Z,{className:"h-4 w-4"})})}),(0,t.jsxs)(j.AW,{align:"end",children:["completada"!==e.estado&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Xi,{onClick:()=>el(e.id_uuid,"en_proceso"),children:"Iniciar"}),(0,t.jsx)(j.Xi,{onClick:()=>el(e.id_uuid,"completada"),children:"Completar"}),(0,t.jsx)(j.Xi,{onClick:()=>el(e.id_uuid,"cancelada"),children:"Cancelar"})]}),"completada"===e.estado&&(0,t.jsx)(j.Xi,{asChild:!0,children:(0,t.jsx)(S.default,{href:"/transacciones?id_cita=".concat(e.id_uuid),children:"Crear Transacci\xf3n"})})]})]})})]},e.id_uuid)}),0===er.length&&(0,t.jsx)(n.SC,{children:(0,t.jsx)(n.pj,{colSpan:6,className:"text-center py-4",children:"No hay citas que mostrar"})})]})]})]}),(0,t.jsx)(q,{open:f,onOpenChange:Z,selectedDate:I?(0,m.Z)(I,"yyyy-MM-dd"):null,selectedSlot:L||null,preselectedService:U,onDateChange:e=>Y(new Date(e)),onSlotChange:W,onSave:()=>{ei(),G(null),Y(null),W(""),ea("service")}}),(0,t.jsx)(o.x,{})]})})}(0,u.lD)({format:m.Z,parse:h.Z,startOfWeek:x.Z,getDay:p.Z,locales:Y})},1098:function(e,a,s){"use strict";s.d(a,{f:function(){return o}});var t=s(57437);s(2265);var i=s(92451),r=s(10407),l=s(78076),n=s(94508),d=s(62869);function o(e){let{className:a,classNames:s,showOutsideDays:o=!0,...c}=e;return(0,t.jsx)(l._W,{showOutsideDays:o,className:(0,n.cn)("p-3",a),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,n.cn)((0,d.d)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:(0,n.cn)("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md","range"===c.mode?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:(0,n.cn)((0,d.d)({variant:"ghost"}),"h-8 w-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start",day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{className:a,...s}=e;return(0,t.jsx)(i.Z,{className:(0,n.cn)("h-4 w-4",a),...s})},IconRight:e=>{let{className:a,...s}=e;return(0,t.jsx)(r.Z,{className:(0,n.cn)("h-4 w-4",a),...s})}},...c})}o.displayName="Calendar"},66070:function(e,a,s){"use strict";s.d(a,{Ol:function(){return n},SZ:function(){return o},Zb:function(){return l},aY:function(){return c},ll:function(){return d}});var t=s(57437),i=s(2265),r=s(94508);let l=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)("div",{ref:a,className:(0,r.cn)("rounded-xl border bg-card text-card-foreground shadow",s),...i})});l.displayName="Card";let n=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)("div",{ref:a,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",s),...i})});n.displayName="CardHeader";let d=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)("h3",{ref:a,className:(0,r.cn)("font-semibold leading-none tracking-tight",s),...i})});d.displayName="CardTitle";let o=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)("p",{ref:a,className:(0,r.cn)("text-sm text-muted-foreground",s),...i})});o.displayName="CardDescription";let c=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)("div",{ref:a,className:(0,r.cn)("p-6 pt-0",s),...i})});c.displayName="CardContent"},53647:function(e,a,s){"use strict";s.d(a,{Bw:function(){return h},DI:function(){return c},Ph:function(){return o},Ql:function(){return p},i4:function(){return m},ki:function(){return u},n5:function(){return x}});var t=s(57437),i=s(2265),r=s(56873),l=s(40875),n=s(30401),d=s(94508);let o=r.fC,c=r.ZA,u=r.B4,m=i.forwardRef((e,a)=>{let{className:s,children:i,...n}=e;return(0,t.jsxs)(r.xz,{ref:a,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...n,children:[i,(0,t.jsx)(r.JO,{asChild:!0,children:(0,t.jsx)(l.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=r.xz.displayName;let h=i.forwardRef((e,a)=>{let{className:s,children:i,position:l="popper",...n}=e;return(0,t.jsx)(r.h_,{children:(0,t.jsx)(r.VY,{ref:a,className:(0,d.cn)("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l,...n,children:(0,t.jsx)(r.l_,{className:(0,d.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i})})})});h.displayName=r.VY.displayName;let x=i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(r.__,{ref:a,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...i})});x.displayName=r.__.displayName;let p=i.forwardRef((e,a)=>{let{className:s,children:i,...l}=e;return(0,t.jsxs)(r.ck,{ref:a,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(r.wU,{children:(0,t.jsx)(n.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(r.eT,{children:i})]})});p.displayName=r.ck.displayName,i.forwardRef((e,a)=>{let{className:s,...i}=e;return(0,t.jsx)(r.Z0,{ref:a,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",s),...i})}).displayName=r.Z0.displayName},81103:function(e,a,s){"use strict";s.d(a,{TooltipProvider:function(){return n},_v:function(){return c},aJ:function(){return o},u:function(){return d}});var t=s(57437),i=s(2265),r=s(61312),l=s(94508);let n=r.zt,d=r.fC,o=r.xz,c=i.forwardRef((e,a)=>{let{className:s,sideOffset:i=4,...n}=e;return(0,t.jsx)(r.VY,{ref:a,sideOffset:i,className:(0,l.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})});c.displayName=r.VY.displayName}},function(e){e.O(0,[1834,2856,9903,8325,4384,6008,8001,5452,4116,2130,51,7648,5643,9067,276,1312,5098,644,1915,6696,277,2971,2117,1744],function(){return e(e.s=91673)}),_N_E=e.O()}]);