(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[630],{75675:function(e,s,i){Promise.resolve().then(i.bind(i,89727))},89727:function(e,s,i){"use strict";i.r(s),i.d(s,{default:function(){return ClientesPage}});var l=i(57437),n=i(2265),t=i(66005),a=i(23611),r=i(45487),c=i(17472),d=i(62898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,d.Z)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),h=(0,d.Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),x=(0,d.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var u=i(61396),m=i.n(u),j=i(81628);function Skeleton(e){let{className:s,...i}=e;return(0,l.jsx)("div",{className:(0,j.cn)("animate-pulse rounded-md bg-muted",s),...i})}var f=i(12899),v=i(62031),p=i(71271);function ClientesTable(e){let{clientes:s,loading:i=!1,onClienteDeleted:d}=e,{toast:u}=(0,p.pm)(),[j,C]=(0,n.useState)(null),[N,y]=(0,n.useState)(!1),eliminarCliente=async()=>{if(j){y(!0);try{let{error:e}=await f.O.from("clientes").delete().eq("id uuid",j.id_uuid);if(e)throw e;u({title:"Cliente eliminado",description:"El cliente ha sido eliminado correctamente"}),null==d||d()}catch(e){console.error("Error eliminando cliente:",e),u({variant:"destructive",title:"Error",description:"No se pudo eliminar el cliente"})}finally{y(!1),C(null)}}};return i?(0,l.jsx)(Skeleton,{className:"h-[400px]"}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(t.iA,{children:[(0,l.jsx)(t.xD,{children:(0,l.jsxs)(t.SC,{children:[(0,l.jsx)(t.ss,{children:"Nombre"}),(0,l.jsx)(t.ss,{children:"Email"}),(0,l.jsx)(t.ss,{children:"Tel\xe9fono"}),(0,l.jsx)(t.ss,{className:"text-right",children:"Acciones"})]})}),(0,l.jsx)(t.RM,{children:s.map(e=>(0,l.jsxs)(t.SC,{children:[(0,l.jsx)(t.pj,{children:e.nombre}),(0,l.jsx)(t.pj,{children:e.email}),(0,l.jsx)(t.pj,{children:e.telefono}),(0,l.jsx)(t.pj,{className:"text-right",children:(0,l.jsxs)(r.h_,{children:[(0,l.jsx)(r.$F,{asChild:!0,children:(0,l.jsxs)(a.z,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,l.jsx)("span",{className:"sr-only",children:"Abrir men\xfa"}),(0,l.jsx)(c.Z,{className:"h-4 w-4"})]})}),(0,l.jsxs)(r.AW,{align:"end",children:[(0,l.jsx)(r.Xi,{asChild:!0,children:(0,l.jsxs)(m(),{href:"/clientes/".concat(e.id_uuid,"/historial"),className:"flex items-center",children:[(0,l.jsx)(o,{className:"mr-2 h-4 w-4"}),"Ver Historial"]})}),(0,l.jsx)(r.Xi,{asChild:!0,children:(0,l.jsxs)(m(),{href:"/clientes/".concat(e.id_uuid,"/editar"),className:"flex items-center",children:[(0,l.jsx)(h,{className:"mr-2 h-4 w-4"}),"Editar"]})}),(0,l.jsxs)(r.Xi,{className:"flex items-center text-destructive",onClick:()=>C(e),children:[(0,l.jsx)(x,{className:"mr-2 h-4 w-4"}),"Eliminar"]})]})]})})]},e.id_uuid))})]}),(0,l.jsx)(v.Vq,{open:!!j,onOpenChange:()=>C(null),children:(0,l.jsxs)(v.cZ,{children:[(0,l.jsxs)(v.fK,{children:[(0,l.jsx)(v.$N,{children:"\xbfEliminar cliente?"}),(0,l.jsxs)(v.Be,{children:["Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 permanentemente el cliente",null==j?void 0:j.nombre," y todos sus datos asociados."]})]}),(0,l.jsxs)(v.cN,{children:[(0,l.jsx)(a.z,{variant:"outline",onClick:()=>C(null),disabled:N,children:"Cancelar"}),(0,l.jsx)(a.z,{variant:"destructive",onClick:eliminarCliente,disabled:N,children:N?"Eliminando...":"Eliminar"})]})]})})]})}var C=i(35831);function ClientesPage(){let[e,s]=(0,n.useState)([]),[i,t]=(0,n.useState)(""),[r,c]=(0,n.useState)("todos"),[d,o]=(0,n.useState)(1),[h,x]=(0,n.useState)(0),[u,j]=(0,n.useState)(!1),[v,p]=(0,n.useState)(null),[N,y]=(0,n.useState)(!1),[k,w]=(0,n.useState)({nombre:"",email:"",telefono:""});(0,n.useEffect)(()=>{cargarClientes()},[i,r,d]),(0,n.useEffect)(()=>{let e=new URLSearchParams(window.location.search),s=e.get("id");s&&p(s)},[]);let cargarClientes=async()=>{j(!0);try{let e=f.O.from("clientes").select("*",{count:"exact"}).order("nombre").range((d-1)*10,10*d-1);i&&(e=e.or("nombre.ilike.%".concat(i,"%,email.ilike.%").concat(i,"%,telefono.ilike.%").concat(i,"%"))),"todos"!==r&&(e=e.eq("estado",r));let{data:l,count:n,error:t}=await e;if(t)throw t;let a=(l||[]).map(e=>({id_uuid:e.id_uuid,nombre:e.nombre,email:e.email,telefono:e.telefono,estado:e.estado}));s(a),x(n||0)}catch(e){console.error("Error cargando clientes:",e)}finally{j(!1)}},b=e.filter(e=>{var s,l;return v?e.id_uuid===v:e.nombre.toLowerCase().includes(i.toLowerCase())||(null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(i.toLowerCase()))||(null===(l=e.telefono)||void 0===l?void 0:l.includes(i))});return(0,l.jsxs)("div",{className:"flex-1 space-y-4 p-8 pt-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between space-y-2",children:[(0,l.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Clientes"}),(0,l.jsx)("div",{className:"flex items-center space-x-2",children:(0,l.jsx)(a.z,{asChild:!0,children:(0,l.jsx)(m(),{href:"/clientes/nuevo",children:"Registrar Cliente"})})})]}),(0,l.jsx)("div",{className:"flex items-center justify-between",children:(0,l.jsx)("div",{className:"flex flex-1 items-center space-x-2",children:(0,l.jsx)(C.I,{placeholder:"Buscar clientes...",className:"w-[150px] lg:w-[250px]",value:i,onChange:e=>t(e.target.value)})})}),(0,l.jsx)(ClientesTable,{clientes:b,loading:u}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Mostrando ",(d-1)*10+1," - ",Math.min(10*d,h)," de ",h," clientes"]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(a.z,{variant:"outline",disabled:1===d,onClick:()=>o(e=>e-1),children:"Anterior"}),(0,l.jsx)(a.z,{variant:"outline",disabled:10*d>=h,onClick:()=>o(e=>e+1),children:"Siguiente"})]})]}),v&&(0,l.jsx)(a.z,{variant:"outline",onClick:()=>{p(null),window.history.pushState({},"","/clientes")},children:"Ver todos los clientes"})]})}}},function(e){e.O(0,[360,503,402,201,580,396,160,20,971,472,744],function(){return e(e.s=75675)}),_N_E=e.O()}]);