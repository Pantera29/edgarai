(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2630],{47057:function(e,s,i){Promise.resolve().then(i.bind(i,913))},913:function(e,s,i){"use strict";i.r(s),i.d(s,{default:function(){return w}});var l=i(57437),n=i(2265),t=i(73578),a=i(62869),r=i(84190),c=i(56266),d=i(39763);let o=(0,d.Z)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),h=(0,d.Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),u=(0,d.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var x=i(27648),m=i(94508);function j(e){let{className:s,...i}=e;return(0,l.jsx)("div",{className:(0,m.cn)("animate-pulse rounded-md bg-muted",s),...i})}var f=i(2141),v=i(26110),p=i(77992);function N(e){let{clientes:s,loading:i=!1,onClienteDeleted:d}=e,{toast:m}=(0,p.pm)(),[N,y]=(0,n.useState)(null),[w,k]=(0,n.useState)(!1),C=async()=>{if(N){k(!0);try{let{error:e}=await f.O.from("clientes").delete().eq("id uuid",N.id_uuid);if(e)throw e;m({title:"Cliente eliminado",description:"El cliente ha sido eliminado correctamente"}),null==d||d()}catch(e){console.error("Error eliminando cliente:",e),m({variant:"destructive",title:"Error",description:"No se pudo eliminar el cliente"})}finally{k(!1),y(null)}}};return i?(0,l.jsx)(j,{className:"h-[400px]"}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(t.iA,{children:[(0,l.jsx)(t.xD,{children:(0,l.jsxs)(t.SC,{children:[(0,l.jsx)(t.ss,{children:"Nombre"}),(0,l.jsx)(t.ss,{children:"Email"}),(0,l.jsx)(t.ss,{children:"Tel\xe9fono"}),(0,l.jsx)(t.ss,{className:"text-right",children:"Acciones"})]})}),(0,l.jsx)(t.RM,{children:s.map(e=>(0,l.jsxs)(t.SC,{children:[(0,l.jsx)(t.pj,{children:e.nombre}),(0,l.jsx)(t.pj,{children:e.email}),(0,l.jsx)(t.pj,{children:e.telefono}),(0,l.jsx)(t.pj,{className:"text-right",children:(0,l.jsxs)(r.h_,{children:[(0,l.jsx)(r.$F,{asChild:!0,children:(0,l.jsxs)(a.z,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,l.jsx)("span",{className:"sr-only",children:"Abrir men\xfa"}),(0,l.jsx)(c.Z,{className:"h-4 w-4"})]})}),(0,l.jsxs)(r.AW,{align:"end",children:[(0,l.jsx)(r.Xi,{asChild:!0,children:(0,l.jsxs)(x.default,{href:"/clientes/".concat(e.id_uuid,"/historial"),className:"flex items-center",children:[(0,l.jsx)(o,{className:"mr-2 h-4 w-4"}),"Ver Historial"]})}),(0,l.jsx)(r.Xi,{asChild:!0,children:(0,l.jsxs)(x.default,{href:"/clientes/".concat(e.id_uuid,"/editar"),className:"flex items-center",children:[(0,l.jsx)(h,{className:"mr-2 h-4 w-4"}),"Editar"]})}),(0,l.jsxs)(r.Xi,{className:"flex items-center text-destructive",onClick:()=>y(e),children:[(0,l.jsx)(u,{className:"mr-2 h-4 w-4"}),"Eliminar"]})]})]})})]},e.id_uuid))})]}),(0,l.jsx)(v.Vq,{open:!!N,onOpenChange:()=>y(null),children:(0,l.jsxs)(v.cZ,{children:[(0,l.jsxs)(v.fK,{children:[(0,l.jsx)(v.$N,{children:"\xbfEliminar cliente?"}),(0,l.jsxs)(v.Be,{children:["Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 permanentemente el cliente",null==N?void 0:N.nombre," y todos sus datos asociados."]})]}),(0,l.jsxs)(v.cN,{children:[(0,l.jsx)(a.z,{variant:"outline",onClick:()=>y(null),disabled:w,children:"Cancelar"}),(0,l.jsx)(a.z,{variant:"destructive",onClick:C,disabled:w,children:w?"Eliminando...":"Eliminar"})]})]})})]})}var y=i(95186);function w(){let[e,s]=(0,n.useState)([]),[i,t]=(0,n.useState)(""),[r,c]=(0,n.useState)("todos"),[d,o]=(0,n.useState)(1),[h,u]=(0,n.useState)(0),[m,j]=(0,n.useState)(!1),[v,p]=(0,n.useState)(null),[w,k]=(0,n.useState)(!1),[C,b]=(0,n.useState)({nombre:"",email:"",telefono:""});(0,n.useEffect)(()=>{g()},[i,r,d]),(0,n.useEffect)(()=>{let e=new URLSearchParams(window.location.search).get("id");e&&p(e)},[]);let g=async()=>{j(!0);try{let e=f.O.from("clientes").select("*",{count:"exact"}).order("nombre").range((d-1)*10,10*d-1);i&&(e=e.or("nombre.ilike.%".concat(i,"%,email.ilike.%").concat(i,"%,telefono.ilike.%").concat(i,"%"))),"todos"!==r&&(e=e.eq("estado",r));let{data:l,count:n,error:t}=await e;if(t)throw t;let a=(l||[]).map(e=>({id_uuid:e.id_uuid,nombre:e.nombre,email:e.email,telefono:e.telefono,estado:e.estado}));s(a),u(n||0)}catch(e){console.error("Error cargando clientes:",e)}finally{j(!1)}},S=e.filter(e=>{var s,l;return v?e.id_uuid===v:e.nombre.toLowerCase().includes(i.toLowerCase())||(null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(i.toLowerCase()))||(null===(l=e.telefono)||void 0===l?void 0:l.includes(i))});return(0,l.jsxs)("div",{className:"flex-1 space-y-4 p-8 pt-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between space-y-2",children:[(0,l.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Clientes"}),(0,l.jsx)("div",{className:"flex items-center space-x-2",children:(0,l.jsx)(a.z,{asChild:!0,children:(0,l.jsx)(x.default,{href:"/clientes/nuevo",children:"Registrar Cliente"})})})]}),(0,l.jsx)("div",{className:"flex items-center justify-between",children:(0,l.jsx)("div",{className:"flex flex-1 items-center space-x-2",children:(0,l.jsx)(y.I,{placeholder:"Buscar clientes...",className:"w-[150px] lg:w-[250px]",value:i,onChange:e=>t(e.target.value)})})}),(0,l.jsx)(N,{clientes:S,loading:m}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Mostrando ",(d-1)*10+1," - ",Math.min(10*d,h)," de ",h," clientes"]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(a.z,{variant:"outline",disabled:1===d,onClick:()=>o(e=>e-1),children:"Anterior"}),(0,l.jsx)(a.z,{variant:"outline",disabled:10*d>=h,onClick:()=>o(e=>e+1),children:"Siguiente"})]})]}),v&&(0,l.jsx)(a.z,{variant:"outline",onClick:()=>{p(null),window.history.pushState({},"","/clientes")},children:"Ver todos los clientes"})]})}}},function(e){e.O(0,[9903,8325,4384,6008,6668,3513,7648,5643,6616,2971,2117,1744],function(){return e(e.s=47057)}),_N_E=e.O()}]);