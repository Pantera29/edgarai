"use client"

import { useEffect, useState } from 'react';
import { useSearchParams } from 'next/navigation';

export default function CustomersCreatePage() {
  const searchParams = useSearchParams();
  const [status, setStatus] = useState<string | null>(null); // Para el estado de la solicitud
  const [error, setError] = useState<string | null>(null); // Para errores

  useEffect(() => {
    // Obtener los par치metros desde la URL
    const name = searchParams.get('name');
    const email = searchParams.get('email');
    const phone = searchParams.get('phone');
    const dealership_id = searchParams.get('dealership_id');

    // Verificar si todos los par치metros est치n presentes
    if (!name || !email || !phone || !dealership_id) {
      setError('Missing required parameters');
      return;
    }

    // Hacer la solicitud al endpoint GET
    const fetchData = async () => {
      try {
        const response = await fetch(
          `/api/customers/create?name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}&phone=${encodeURIComponent(phone)}&dealership_id=${encodeURIComponent(dealership_id)}`,
          {
            method: 'GET',
          }
        );

        if (response.ok) {
          const data = await response.json();
          console.log('Customer created:', data);
          setStatus('Customer created successfully');
        } else {
          console.error('Failed to create customer:', response.statusText);
          setError('Failed to create customer');
        }
      } catch (error) {
        console.error('Error during fetch:', error);
        setError('Error during fetch');
      }
    };

    // Llamar a la funci칩n para hacer el GET
    fetchData();
  }, [searchParams]);

  return (
    <div>
      {status && <p>{status}</p>}
      {error && <p style={{ color: 'red' }}>{error}</p>}
    </div>
  );
}
